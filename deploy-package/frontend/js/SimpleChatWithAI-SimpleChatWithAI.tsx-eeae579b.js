import{r as e,j as r,M as t,u as s}from"./react-vendor-chunk-d925dc83.js";import{u as a,b as o}from"../assets/index-c53f325e.js";import{a as n}from"./data-fetching-chunk-60e2cc94.js";import{s as l}from"./secureStorage-chunk-b945963c.js";import"./editor-chunk-85777d73.js";const i=e=>new Promise(r=>setTimeout(r,e)),c={hello:"Hello! I'm your PowerShell assistant. How can I help you today?",help:"I can help you with PowerShell scripting tasks. You can ask me questions about PowerShell commands, syntax, best practices, or how to accomplish specific tasks.",script:"PowerShell scripts are files with a .ps1 extension containing a series of PowerShell commands. They allow you to automate tasks and create reusable functionality. Would you like to know how to create or run a PowerShell script?",command:"PowerShell has many useful cmdlets. Some common ones include:\n\n- Get-Content: Reads the content of a file\n- Set-Content: Writes content to a file\n- Get-Process: Gets information about running processes\n- Invoke-RestMethod: Makes HTTP requests\n\nIs there a specific command you'd like to learn about?",default:"As a PowerShell assistant, I can help you with PowerShell scripting. For example, I can explain commands, help debug scripts, or suggest how to automate tasks."},d=[{id:"mock-1",messages:[{role:"user",content:"How do I list running processes in PowerShell?",timestamp:new Date("2025-03-01T12:00:00Z")},{role:"assistant",content:"You can use the `Get-Process` cmdlet to list running processes in PowerShell. Here's a basic example:\n\n```powershell\nGet-Process\n```\n\nYou can also filter the results:\n\n```powershell\nGet-Process -Name chrome\n```\n\nOr sort them by memory usage:\n\n```powershell\nGet-Process | Sort-Object -Property WorkingSet -Descending | Select-Object -First 10\n```",timestamp:new Date("2025-03-01T12:01:00Z")}],score:.95,date:"2025-03-01",timestamp:"2025-03-01T12:01:00Z"},{id:"mock-2",messages:[{role:"user",content:"How do I create a function in PowerShell?",timestamp:new Date("2025-03-02T14:30:00Z")},{role:"assistant",content:'In PowerShell, you can create functions using the `function` keyword. Here\'s a basic example:\n\n```powershell\nfunction Get-Greeting {\n    param(\n        [string]$Name = "World"\n    )\n    \n    return "Hello, $Name!"\n}\n\n# Call the function\nGet-Greeting\nGet-Greeting -Name "PowerShell"\n```',timestamp:new Date("2025-03-02T14:31:00Z")}],score:.85,date:"2025-03-02",timestamp:"2025-03-02T14:31:00Z"}],h=async(e,r,t)=>{try{try{let a="";try{a=await l.getSecure("openai_api_key")||""}catch(s){console.warn("Failed to get API key from secure storage, trying localStorage"),a=localStorage.getItem("openai_api_key")||""}if(console.log("API key status:",a?`Found (${a.length} chars)`:"Not found"),a&&a.length>10){console.log("Attempting to use real AI service");const s="http://localhost:4000/api";console.log("api-simple.ts API URL is set to:",s);return(await n.post(`${s}/chat`,{messages:e,api_key:a,agent_type:r||"assistant",session_id:t},{headers:{"Content-Type":"application/json"},timeout:6e4})).data}}catch(s){console.warn("Real AI service failed, using mock:",s)}console.log("Using mock response service"),await i(1e3+1e3*Math.random());const a=e.filter(e=>"user"===e.role).pop();if(!a)return{response:"I don't see a question. How can I help you?"};return{response:(e=>{const r=e.toLowerCase();for(const[t,s]of Object.entries(c))if(r.includes(t))return s;return c.default})(a.content)}}catch(s){return console.error("Error sending chat message:",s),{response:"Sorry, I encountered an error. Please try again later."}}},m=async e=>{try{return console.log("Mock: Saving chat history",e.length,"messages"),await i(500+500*Math.random()),{success:!0}}catch(r){throw console.error("Error saving chat history:",r),new Error("Failed to save chat history")}},g=async()=>{try{return console.log("Mock: Clearing chat history"),await i(300+300*Math.random()),{success:!0}}catch(e){throw console.error("Error clearing chat history:",e),new Error("Failed to clear chat history")}},u=async e=>{try{return console.log("Mock: Searching chat history for",e),await i(800+800*Math.random()),d}catch(r){throw console.error("Error searching chat history:",r),new Error("Failed to search chat history")}},b=async e=>{try{return console.log("Mock: Uploading script",e.name),await i(1e3+1e3*Math.random()),{id:"mock-script-"+Date.now(),name:e.name,content:e.content,description:e.description,isPublic:e.isPublic,createdAt:(new Date).toISOString()}}catch(r){throw console.error("Error uploading script:",r),new Error("Failed to upload script")}},p=(r={})=>{const{initialMessages:t=[{role:"assistant",content:"Welcome to PowerShell AI Assistant! I can help you with PowerShell scripting tasks. What would you like help with today?"}],autoSave:s=!0,mockMode:a=!1}=r,[o,n]=e.useState(t),[l,i]=e.useState(""),[c,d]=e.useState(!1),[b,p]=e.useState(!1),[y,x]=e.useState(""),[f,w]=e.useState([]),[v,j]=e.useState(!1),[k,S]=e.useState(!1),[N,C]=e.useState(null),[P,I]=e.useState(!1),[E,F]=e.useState(a),[A,M]=e.useState(void 0),$=e.useRef(null),D=e.useRef(null),T=e.useRef(null);e.useEffect(()=>{if(!s)return;try{localStorage.setItem("psscript_chat_history",JSON.stringify(o))}catch(r){console.error("Failed to save chat history to localStorage:",r);try{localStorage.removeItem("psscript_chat_history"),localStorage.setItem("psscript_chat_history",JSON.stringify(o.slice(-10)))}catch(t){console.error("Failed to save even after clearing:",t)}}const e=setTimeout(()=>{(async()=>{if(!(E||o.length<=1)){p(!0);try{const e=new Promise((e,r)=>setTimeout(()=>r(new Error("Save operation timed out")),5e3));await Promise.race([m(o),e])}catch(e){console.error("Failed to save chat history to server:",e),e instanceof Error&&e.message.includes("Network")&&F(!0)}finally{p(!1)}}})()},1e3);return()=>clearTimeout(e)},[o,E,s]),e.useEffect(()=>{try{const r=localStorage.getItem("psscript_chat_history");if(r)try{const e=JSON.parse(r);Array.isArray(e)&&e.length>0&&n(e)}catch(e){console.error("Failed to parse saved chat:",e),localStorage.removeItem("psscript_chat_history")}}catch(e){console.error("Error accessing localStorage:",e)}},[]),e.useEffect(()=>{$.current?.scrollIntoView({behavior:"smooth"})},[o]),e.useEffect(()=>{k||D.current?.focus()},[k]);const _=e.useCallback(async e=>{if(e.trim())try{const a={role:"user",content:e,timestamp:new Date};i(""),d(!0),n(e=>[...e,a]);try{const e=[...o,a],s=new Promise((e,r)=>setTimeout(()=>r(new Error("Request timed out")),3e4));try{const r=await Promise.race([h(e,"assistant",A),s]);r.session_id&&M(r.session_id),n(e=>[...e,{role:"assistant",content:r.response,timestamp:new Date}])}catch(r){if(r.message&&r.message.includes("Network")&&!E){F(!0);try{const r=await h(e);return void n(e=>[...e,{role:"assistant",content:r.response,timestamp:new Date}])}catch(t){console.error("Mock service also failed:",t)}}let s="I'm having trouble connecting to my backend. Please try again in a moment.";r instanceof Error?s=r.message||s:"string"==typeof r?s=r:r&&"object"==typeof r&&"message"in r&&(s=r.message||s),n(e=>[...e,{role:"assistant",content:s,timestamp:new Date}])}}catch(s){n(e=>[...e,{role:"assistant",content:"Something went wrong processing your request. Please try again.",timestamp:new Date}])}}catch(s){console.error("Error in sendMessage:",s)}finally{d(!1)}},[o,E,A]),R=e.useCallback(()=>{window.confirm("Clear chat history?")&&(n([{role:"assistant",content:"# Chat history cleared.\n\nHow can I help you with PowerShell today?"}]),g().catch(e=>{console.error("Failed to clear chat history from server:",e)}))},[]),H=e.useCallback(e=>new Promise((r,t)=>{const s=new FileReader;s.onload=e=>{e.target?.result?r(e.target.result):t(new Error("Failed to read file content"))},s.onerror=()=>t(s.error),s.readAsText(e)}),[]),L=e.useCallback(async e=>{if(e){I(!0);try{let t="";try{if(t=await H(e),!t||t.includes("\0")||/[\x00-\x08\x0B\x0C\x0E-\x1F]/.test(t))throw new Error("File appears to be binary or contains invalid characters");t.length>1e5&&(t=t.substring(0,1e5)+"\n\n... [Content truncated due to size] ...")}catch(r){throw new Error("Could not read file contents")}const s=`I'm uploading a PowerShell script named "${e.name}" for analysis. Here's the content:\n\n\`\`\`powershell\n${t}\n\`\`\`\n\nCan you analyze this script and provide feedback?`;await _(s)}catch(t){console.error("Error uploading file:",t),n(r=>[...r,{role:"user",content:`I was trying to upload a file named "${e.name}" but encountered an error.`,timestamp:new Date},{role:"assistant",content:"Sorry, I encountered an error processing your file. Please try again or paste the script directly.",timestamp:new Date}])}finally{I(!1),C(null),T.current&&(T.current.value="")}}},[H,_]),G=e.useCallback(e=>{const r=[...e.matchAll(/```powershell\n([\s\S]*?)```/g)];if(r.length>0)return r[0][1];const t=[...e.matchAll(/```([\s\S]*?)```/g)];return t.length>0?t[0][1]:""},[]),U=e.useCallback(e=>{const r=e.match(/function\s+([A-Za-z0-9\-_]+)/);if(r&&r[1])return`${r[1]}.ps1`;const t=e.match(/^#\s*(.+)$/m);if(t&&t[1]){return`${t[1].split(" ").slice(0,3).join("-").toLowerCase().replace(/[^a-z0-9\-]/g,"")}.ps1`}return"new-script.ps1"},[]),q=e.useCallback(async e=>{if(e.trim()){j(!0);try{const r=await u(e),t=Array.isArray(r)?r.map(e=>({id:e.id||String(Math.random()),messages:Array.isArray(e.messages)?e.messages:[],score:"number"==typeof e.score?e.score:1,date:e.date||new Date(e.timestamp||Date.now()).toLocaleDateString()})):[];w(t)}catch(r){console.error("Error searching chat history:",r),w([])}finally{j(!1)}}},[]),W=e.useCallback(e=>{Array.isArray(e)&&e.length>0&&(n(e),S(!1))},[]);return{messages:o,input:l,isLoading:c,isSaving:b,searchQuery:y,searchResults:f,isSearching:v,showSearch:k,selectedFile:N,isUploading:P,useMockService:E,sessionId:A,messagesEndRef:$,inputRef:D,fileInputRef:T,setInput:i,sendMessage:_,clearChat:R,uploadFile:L,setSelectedFile:C,extractPowerShellCode:G,generateScriptName:U,setShowSearch:S,setSearchQuery:x,searchChatHistory:q,loadChatHistory:W,setUseMockService:F,setSessionId:M}},y=({message:s,theme:a,onSaveScript:o})=>{const[n,l]=e.useState(!1),i=e=>{const{children:t,className:s,node:i,...c}=e,d=/language-(\w+)/.exec(s||""),h=d?d[1]:"",m=!h||"powershell"===h;return r.jsxs("div",{className:"relative rounded-md overflow-hidden "+("dark"===a?"bg-gray-800":"bg-gray-100"),children:[r.jsxs("div",{className:"flex justify-between items-center px-4 py-2 text-xs border-b border-gray-700",children:[r.jsx("span",{children:m?"PowerShell":h}),r.jsxs("div",{className:"flex space-x-2",children:[n&&r.jsx("span",{className:"text-xs "+("dark"===a?"text-green-400":"text-green-600"),children:"Copied!"}),r.jsx("button",{onClick:()=>{return e=t,void navigator.clipboard.writeText(e).then(()=>{l(!0),setTimeout(()=>l(!1),2e3)}).catch(e=>{console.error("Failed to copy code: ",e)});var e},className:"px-2 py-1 rounded text-xs "+("dark"===a?"bg-gray-700 hover:bg-gray-600 text-gray-300":"bg-gray-200 hover:bg-gray-300 text-gray-700"),children:"Copy"}),o&&m&&r.jsx("button",{onClick:o,className:"px-2 py-1 rounded text-xs "+("dark"===a?"bg-blue-700 hover:bg-blue-600 text-white":"bg-blue-600 hover:bg-blue-500 text-white"),children:"Save as Script"})]})]}),r.jsx("pre",{className:`p-4 overflow-x-auto ${s}`,...c,children:t})]})},c={code:({node:e,inline:t,className:s,children:o,...n})=>t?r.jsx("code",{className:("dark"===a?"bg-gray-800 text-gray-200":"bg-gray-200 text-gray-800")+" px-1 py-0.5 rounded text-sm font-mono",...n,children:o}):i({children:String(o).replace(/\n$/,""),className:s,...n}),p:({children:e})=>r.jsx("p",{className:"mb-4 last:mb-0",children:e}),h1:({children:e})=>r.jsx("h1",{className:"text-2xl font-bold mb-4",children:e}),h2:({children:e})=>r.jsx("h2",{className:"text-xl font-bold mb-3",children:e}),h3:({children:e})=>r.jsx("h3",{className:"text-lg font-bold mb-2",children:e}),ul:({children:e})=>r.jsx("ul",{className:"list-disc pl-6 mb-4",children:e}),ol:({children:e})=>r.jsx("ol",{className:"list-decimal pl-6 mb-4",children:e}),li:({children:e})=>r.jsx("li",{className:"mb-1",children:e}),a:({href:e,children:t})=>r.jsx("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:("dark"===a?"text-blue-400":"text-blue-600")+" hover:underline",children:t}),blockquote:({children:e})=>r.jsx("blockquote",{className:`border-l-4 ${"dark"===a?"border-gray-600 bg-gray-800":"border-gray-300 bg-gray-100"} pl-4 py-2 mb-4 italic`,children:e}),table:({children:e})=>r.jsx("div",{className:"overflow-x-auto mb-4",children:r.jsx("table",{className:`min-w-full ${"dark"===a?"border-gray-700":"border-gray-300"} border`,children:e})}),thead:({children:e})=>r.jsx("thead",{className:""+("dark"===a?"bg-gray-800":"bg-gray-200"),children:e}),tbody:({children:e})=>r.jsx("tbody",{children:e}),tr:({children:e})=>r.jsx("tr",{className:("dark"===a?"border-gray-700":"border-gray-300")+" border-t",children:e}),th:({children:e})=>r.jsx("th",{className:("dark"===a?"border-gray-700":"border-gray-300")+" border px-4 py-2 text-left font-semibold",children:e}),td:({children:e})=>r.jsx("td",{className:("dark"===a?"border-gray-700":"border-gray-300")+" border px-4 py-2",children:e}),hr:()=>r.jsx("hr",{className:"my-4 "+("dark"===a?"border-gray-700":"border-gray-300")})};return r.jsx("div",{className:"mb-4 "+("user"===s.role?"flex justify-end":"flex justify-start"),children:r.jsxs("div",{className:"max-w-3xl rounded-lg p-3 "+("user"===s.role?"dark"===a?"bg-blue-700 text-white":"bg-blue-600 text-white":"dark"===a?"bg-gray-800 text-gray-200":"bg-white text-gray-800 border border-gray-300"),children:["user"===s.role?r.jsx("div",{className:"whitespace-pre-wrap",children:s.content}):r.jsxs("div",{className:"markdown-content",children:[r.jsx(t,{components:c,children:s.content}),(d=s.content,d.includes("```")&&o&&r.jsx("div",{className:"mt-4 flex justify-end",children:r.jsx("button",{onClick:o,className:"px-3 py-1 rounded text-sm "+("dark"===a?"bg-blue-700 hover:bg-blue-600 text-white":"bg-blue-600 hover:bg-blue-500 text-white"),children:"Save as Script"})}))]}),s.timestamp&&r.jsx("div",{className:"text-xs mt-2 text-right "+("user"===s.role?"text-blue-200":"text-gray-500"),children:new Date(s.timestamp).toLocaleTimeString()})]})});var d},x=()=>{const{theme:t,toggleTheme:n}=a();o();const l=s(),{messages:i,input:c,isLoading:d,isSaving:h,searchQuery:m,searchResults:g,isSearching:u,showSearch:x,selectedFile:f,isUploading:w,sessionId:v,messagesEndRef:j,inputRef:k,fileInputRef:S,setInput:N,sendMessage:C,clearChat:P,uploadFile:I,setSelectedFile:E,extractPowerShellCode:F,generateScriptName:A,setShowSearch:M,setSearchQuery:$,searchChatHistory:D,loadChatHistory:T,setSessionId:_}=p({autoSave:!0,mockMode:!1}),[R,H]=e.useState(!1),[L,G]=e.useState(""),[U,q]=e.useState(""),[W,z]=e.useState("");return r.jsxs("div",{className:"flex flex-col h-full "+("dark"===t?"bg-gray-900 text-white":"bg-white text-gray-900"),children:[r.jsxs("div",{className:"p-4 flex justify-between items-center "+("dark"===t?"bg-gray-800":"bg-blue-600 text-white"),children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsxs("button",{onClick:()=>l("/dashboard"),className:"px-3 py-1 rounded bg-opacity-20 bg-white hover:bg-opacity-30 flex items-center","aria-label":"Back to Dashboard",children:[r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),r.jsx("span",{className:"text-sm font-medium",children:"Dashboard"})]}),r.jsx("h1",{className:"text-xl font-bold",children:"PSScript AI Assistant"})]}),r.jsxs("div",{className:"flex gap-2 items-center",children:[h&&r.jsx("span",{className:"text-xs opacity-70",children:"Saving..."}),r.jsxs(r.Fragment,{children:[r.jsxs("button",{onClick:()=>M(e=>!e),className:"px-3 py-1 rounded bg-opacity-20 bg-white hover:bg-opacity-30 flex items-center",children:[r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),x?"Close":"Search"]}),r.jsxs("button",{onClick:()=>l("/chat/history"),className:"px-3 py-1 rounded bg-opacity-20 bg-white hover:bg-opacity-30 flex items-center",children:[r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"History"]})]}),r.jsx("button",{onClick:n,className:"px-3 py-1 rounded bg-opacity-20 bg-white hover:bg-opacity-30",children:"dark"===t?"Light":"Dark"}),r.jsx("button",{onClick:P,className:"px-3 py-1 rounded bg-opacity-20 bg-white hover:bg-opacity-30",children:"Clear"})]})]}),x&&r.jsxs("div",{className:"p-4 "+("dark"===t?"bg-gray-800 border-b border-gray-700":"bg-white border-b border-gray-200"),children:[r.jsxs("form",{onSubmit:async e=>{e.preventDefault(),m.trim()&&await D(m)},className:"flex gap-2 mb-4",children:[r.jsx("input",{type:"text",value:m,onChange:e=>$(e.target.value),placeholder:"Search your chat history...",className:`flex-1 p-2 rounded ${"dark"===t?"bg-gray-700 border-gray-600":"bg-gray-100 border-gray-300"} border focus:ring-2 focus:ring-blue-500 focus:outline-none`,disabled:u}),r.jsx("button",{type:"submit",disabled:u||!m.trim(),className:"px-4 py-2 rounded font-medium "+("dark"===t?"bg-blue-600 hover:bg-blue-500 disabled:bg-gray-700":"bg-blue-600 text-white hover:bg-blue-500 disabled:bg-gray-300"),children:u?"Searching...":"Search"})]}),r.jsxs("div",{className:`max-h-60 overflow-y-auto rounded ${g.length>0?"border":""} ${"dark"===t?"border-gray-700":"border-gray-200"}`,children:[g.map((e,s)=>r.jsxs("div",{className:`p-3 cursor-pointer ${"dark"===t?"hover:bg-gray-700 border-b border-gray-700":"hover:bg-gray-100 border-b border-gray-200"} ${s===g.length-1?"border-b-0":""}`,onClick:()=>T(e.messages),children:[r.jsxs("div",{className:"flex justify-between mb-1",children:[r.jsx("span",{className:"text-sm font-medium",children:e.date}),r.jsxs("span",{className:"text-xs px-2 py-0.5 rounded-full "+("dark"===t?"bg-blue-900 text-blue-200":"bg-blue-100 text-blue-800"),children:["Score: ",e.score.toFixed(2)]})]}),r.jsx("div",{className:"text-sm truncate",children:e.messages[0]?.content||"No content"})]},e.id||s)),0===g.length&&""!==m.trim()&&!u&&r.jsx("div",{className:"p-4 text-center text-gray-500",children:"No results found"}),u&&r.jsx("div",{className:"p-4 text-center",children:r.jsx("div",{className:"inline-block",children:r.jsxs("div",{className:"flex space-x-2",children:[r.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce"}),r.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce delay-150"}),r.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce delay-300"})]})})})]})]}),r.jsxs("div",{className:"flex-1 p-4 overflow-y-auto "+("dark"===t?"bg-gray-900":"bg-gray-100"),children:[0===i.length?r.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{children:"No messages yet"}),r.jsx("p",{className:"text-sm mt-2",children:"Start a conversation by typing a message below"})]})}):i.map((e,s)=>r.jsx(y,{message:e,theme:t,onSaveScript:"assistant"===e.role?()=>(e=>{try{const r=F(e.content);r&&r.trim()?(G(r),q(A(r)),z(""),H(!0)):alert("No PowerShell code found in this message. Please make sure the AI has generated code blocks.")}catch(r){console.error("Error opening script modal:",r),alert("There was an error processing this code. Please try again.")}})(e):void 0},s)),d&&r.jsx("div",{className:"flex items-center mb-4",children:r.jsx("div",{className:"p-3 rounded-lg "+("dark"===t?"bg-gray-800":"bg-white"),children:r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsxs("div",{className:"flex space-x-2",children:[r.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce"}),r.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce delay-150"}),r.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce delay-300"})]}),r.jsx("span",{className:"text-sm text-gray-500",children:"o3-mini is thinking..."})]})})}),r.jsx("div",{ref:j})]}),r.jsxs("div",{className:"p-4 "+("dark"===t?"bg-gray-800":"bg-white border-t"),children:[r.jsxs("div",{className:"flex gap-2 mb-2",children:[r.jsx("label",{htmlFor:"file-upload",className:"sr-only",children:"Upload PowerShell Script"}),r.jsx("input",{id:"file-upload",ref:S,type:"file",accept:".ps1,.psm1,.psd1",onChange:e=>{e.target.files&&e.target.files.length>0&&E(e.target.files[0])},className:"hidden",multiple:!1,"aria-label":"Upload PowerShell Script"}),r.jsx("button",{type:"button",onClick:()=>S.current?.click(),className:"px-3 py-1 rounded text-sm "+("dark"===t?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"),disabled:d||w,children:"Upload Script"}),f&&r.jsxs("div",{className:"flex-1 flex items-center",children:[r.jsx("span",{className:"text-sm truncate",children:f.name}),r.jsx("button",{type:"button",onClick:async()=>{f&&await I(f)},className:"ml-2 px-3 py-1 rounded text-sm "+("dark"===t?"bg-green-700 hover:bg-green-600 text-white":"bg-green-600 hover:bg-green-500 text-white"),disabled:d||w,children:w?"Uploading...":"Analyze"}),r.jsx("button",{type:"button",onClick:()=>E(null),className:"ml-2 px-3 py-1 rounded text-sm "+("dark"===t?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"),disabled:d||w,children:"Cancel"})]})]}),r.jsxs("form",{onSubmit:async e=>{e.preventDefault(),c.trim()&&await C(c)},className:"flex gap-2",children:[r.jsx("input",{ref:k,type:"text",value:c,onChange:e=>N(e.target.value),placeholder:"Type your PowerShell question...",className:`flex-1 p-2 rounded ${"dark"===t?"bg-gray-700 border-gray-600":"bg-gray-100 border-gray-300"} border focus:ring-2 focus:ring-blue-500 focus:outline-none`,disabled:d||w}),r.jsx("button",{type:"submit",disabled:d||w||!c.trim(),className:"px-4 py-2 rounded font-medium "+("dark"===t?"bg-blue-600 hover:bg-blue-500 disabled:bg-gray-700":"bg-blue-600 text-white hover:bg-blue-500 disabled:bg-gray-300"),children:d?"Sending...":"Send"})]}),r.jsx("p",{className:"text-xs text-center mt-2 opacity-60",children:h?"Saving chat...":"Chat saved"})]}),R&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"rounded-lg shadow-lg max-w-lg w-full max-h-[90vh] overflow-y-auto\n            "+("dark"===t?"bg-gray-800 text-white":"bg-white text-gray-900"),children:[r.jsxs("div",{className:"p-4 border-b "+("dark"===t?"border-gray-700":"border-gray-200"),children:[r.jsx("h2",{className:"text-xl font-bold",children:"Create New Script"}),r.jsx("p",{className:"text-sm opacity-70 mt-1",children:"Save this code as a new PowerShell script"})]}),r.jsxs("div",{className:"p-4",children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Script Name"}),r.jsx("input",{type:"text",value:U,onChange:e=>q(e.target.value),placeholder:"script-name.ps1",className:`w-full p-2 rounded ${"dark"===t?"bg-gray-700 border-gray-600":"bg-gray-100 border-gray-300"} border focus:ring-2 focus:ring-blue-500 focus:outline-none`})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description"}),r.jsx("input",{type:"text",value:W,onChange:e=>z(e.target.value),placeholder:"Brief description of what the script does",className:`w-full p-2 rounded ${"dark"===t?"bg-gray-700 border-gray-600":"bg-gray-100 border-gray-300"} border focus:ring-2 focus:ring-blue-500 focus:outline-none`})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Script Content"}),r.jsx("div",{className:`w-full rounded ${"dark"===t?"bg-gray-700 border-gray-600":"bg-gray-100 border-gray-300"} border p-2 h-60 overflow-y-auto`,children:r.jsx("pre",{className:"whitespace-pre-wrap font-mono text-sm",children:L})})]})]}),r.jsxs("div",{className:"p-4 border-t flex justify-end gap-2 "+("dark"===t?"border-gray-700":"border-gray-200"),children:[r.jsx("button",{type:"button",onClick:()=>H(!1),className:"px-4 py-2 rounded "+("dark"===t?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"),children:"Cancel"}),r.jsx("button",{type:"button",onClick:async()=>{if(U&&L)try{const r={name:U,content:L,description:W||"Created from chat",isPublic:!1},t=await b(r);if(H(!1),C(`I've saved the script "${U}" successfully.`),t&&t.id)try{l(`/scripts/${t.id}`)}catch(e){console.error("Navigation error:",e)}}catch(r){console.error("Error creating script:",r),H(!1),C(`Sorry, I couldn't save the script "${U}". There was an error.`)}else alert("Script name and content are required")},className:"px-4 py-2 rounded font-medium "+("dark"===t?"bg-blue-600 hover:bg-blue-500":"bg-blue-600 text-white hover:bg-blue-500"),children:"Create Script"})]})]})})]})};export{x as default};
