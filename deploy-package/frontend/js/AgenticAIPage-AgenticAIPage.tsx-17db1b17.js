import{r as e,j as a,T as s,s as t,G as n,S as r,t as i,v as l,D as o,P as c,w as d,x as m,W as p,y as x,z as h,I as u,J as g,K as y,p as j,M as f,Q as b,q as v,U as w,X as S,Y as I,Z as $,$ as N,a0 as k,a1 as C,a2 as P,a3 as A,a4 as z,a5 as E,a6 as L,a7 as R,a8 as O,a9 as D,aa as B,ab as M,ac as T,ad as G,ae as W,af as F,ag as _,C as U,f as q,ah as H,ai as K,aj as Q,ak as V,al as Y}from"./react-vendor-chunk-d925dc83.js";import{d as X}from"../assets/index-c53f325e.js";import{a as J}from"./data-fetching-chunk-60e2cc94.js";import"./editor-chunk-85777d73.js";const Z=({score:e,label:t,color:n,icon:r})=>a.jsxs(j,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",p:1,children:[a.jsxs(j,{position:"relative",display:"inline-flex",children:[a.jsx(w,{variant:"determinate",value:e,size:70,thickness:5,sx:{color:n}}),a.jsx(j,{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",children:a.jsx(s,{variant:"h6",component:"div",color:n,children:e})})]}),a.jsxs(j,{display:"flex",alignItems:"center",justifyContent:"center",gap:.5,mt:1,children:[r,a.jsx(s,{variant:"body2",color:"text.secondary",children:t})]})]}),ee=({suggestions:e})=>e.length?a.jsxs(j,{mt:2,children:[a.jsx(s,{variant:"h6",gutterBottom:!0,children:"Suggestions"}),a.jsx(j,{component:"ul",sx:{pl:2},children:e.map((e,t)=>a.jsx(j,{component:"li",sx:{mb:1,"&::marker":{color:"primary.main"}},children:a.jsx(s,{variant:"body2",children:e})},t))})]}):null,ae=({commandDetails:e})=>e&&0!==Object.keys(e).length?a.jsxs(j,{mt:3,children:[a.jsxs(s,{variant:"h6",gutterBottom:!0,display:"flex",alignItems:"center",children:[a.jsx(S,{fontSize:"small",sx:{mr:1}}),"Command Details"]}),Object.entries(e).map(([e,t])=>a.jsxs(x,{sx:{mb:1},children:[a.jsx(h,{expandIcon:a.jsx(u,{}),children:a.jsx(s,{variant:"subtitle1",sx:{fontFamily:"monospace",fontWeight:"bold"},children:e})}),a.jsxs(y,{children:[a.jsx(s,{variant:"body2",paragraph:!0,children:t.description}),t.parameters&&t.parameters.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(s,{variant:"subtitle2",children:"Parameters:"}),a.jsx(j,{component:"ul",sx:{pl:2},children:t.parameters.map((e,t)=>a.jsx(j,{component:"li",sx:{mb:1},children:a.jsxs(s,{variant:"body2",sx:{fontFamily:"monospace"},children:[a.jsx("strong",{children:e.name}),": ",e.description]})},t))})]})]})]},e))]}):null,se=({references:e})=>e&&0!==e.length?a.jsxs(j,{mt:3,children:[a.jsxs(s,{variant:"h6",gutterBottom:!0,display:"flex",alignItems:"center",children:[a.jsx(I,{fontSize:"small",sx:{mr:1}}),"Documentation References"]}),a.jsx(j,{component:"ul",sx:{pl:2},children:e.map((e,t)=>a.jsx(j,{component:"li",sx:{mb:1},children:a.jsxs($,{href:e.url,target:"_blank",rel:"noopener noreferrer",sx:{display:"flex",alignItems:"center"},children:[a.jsx(s,{variant:"body2",children:e.title}),a.jsx(I,{fontSize:"small",sx:{ml:.5,fontSize:"0.9rem"}})]})},t))})]}):null,te=({examples:e})=>e&&0!==e.length?a.jsxs(j,{mt:3,children:[a.jsxs(s,{variant:"h6",gutterBottom:!0,display:"flex",alignItems:"center",children:[a.jsx(g,{fontSize:"small",sx:{mr:1}}),"Similar Script Examples"]}),e.map((e,t)=>a.jsxs(x,{sx:{mb:1},children:[a.jsxs(h,{expandIcon:a.jsx(u,{}),children:[a.jsx(s,{variant:"subtitle1",children:e.title||`Example ${t+1}`}),e.similarity&&a.jsx(N,{label:`${Math.round(100*e.similarity)}% match`,size:"small",color:"primary",variant:"outlined",sx:{ml:2}})]}),a.jsxs(y,{children:[e.description&&a.jsx(s,{variant:"body2",paragraph:!0,children:e.description}),e.script&&a.jsx(k,{language:"powershell",style:C,wrapLines:!0,wrapLongLines:!0,children:e.script})]})]},t))]}):null,ne=({analysis:w,isLoading:S,error:I,onAskQuestion:$})=>{const[N,k]=e.useState("");if(S)return a.jsxs("div",{className:"ai-analysis-loading",children:[a.jsx(s,{variant:"h5",gutterBottom:!0,children:"Analyzing script with AI..."}),a.jsx(s,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Our agentic AI is analyzing your script, searching for relevant documentation, and finding similar examples."}),a.jsx(t,{sx:{mt:2,mb:3}}),a.jsxs(n,{container:!0,spacing:2,children:[a.jsx(n,{item:!0,xs:12,md:4,children:a.jsx(r,{variant:"rectangular",height:100})}),a.jsx(n,{item:!0,xs:12,md:8,children:a.jsx(r,{variant:"rectangular",height:100})}),a.jsx(n,{item:!0,xs:12,children:a.jsx(r,{variant:"rectangular",height:200})})]})]});if(I)return a.jsxs("div",{className:"ai-analysis-error",children:[a.jsx(i,{severity:"error",sx:{mb:2},children:I}),a.jsx(s,{variant:"body2",children:"Please check your API key or try again later. If the problem persists, contact support."})]});if(!w)return a.jsxs("div",{className:"ai-analysis-empty",children:[a.jsx(s,{variant:"h6",gutterBottom:!0,children:"No analysis available"}),a.jsx(s,{variant:"body2",color:"text.secondary",children:"Submit a script for analysis to see AI-powered insights."})]});const{purpose:C,securityScore:P,codeQualityScore:A,riskScore:z,suggestions:E,commandDetails:L,msDocsReferences:R,examples:O,rawAnalysis:D}=w.analysis;return a.jsxs("div",{className:"ai-analysis-container",children:[a.jsxs("div",{className:"ai-analysis-header",children:[a.jsxs(s,{variant:"h5",gutterBottom:!0,display:"flex",alignItems:"center",children:[a.jsx(l,{sx:{mr:1}})," AI Script Analysis"]}),a.jsx(s,{variant:"body2",color:"text.secondary",children:"Our agentic AI assistant has analyzed your script and gathered relevant information."}),w.metadata&&a.jsxs(s,{variant:"caption",color:"text.secondary",display:"block",mt:1,children:["Analyzed using ",w.metadata.model," in ",w.metadata.processingTime?.toFixed(2)||"?"," seconds"]})]}),a.jsx(o,{sx:{mb:3}}),a.jsx("div",{className:"ai-analysis-score-section",children:a.jsxs(c,{variant:"outlined",sx:{p:2,backgroundColor:"background.paper"},children:[a.jsx(s,{variant:"h6",gutterBottom:!0,children:"Script Purpose"}),a.jsx(s,{variant:"body1",children:C})]})}),a.jsx("div",{className:"ai-analysis-score-section",children:a.jsxs(n,{container:!0,spacing:2,justifyContent:"center",mb:3,children:[a.jsx(n,{item:!0,children:a.jsx(Z,{score:P,label:"Security",color:P>70?"success.main":P>40?"warning.main":"error.main",icon:a.jsx(d,{fontSize:"small"})})}),a.jsx(n,{item:!0,children:a.jsx(Z,{score:A,label:"Code Quality",color:A>70?"success.main":A>40?"warning.main":"error.main",icon:a.jsx(m,{fontSize:"small"})})}),a.jsx(n,{item:!0,children:a.jsx(Z,{score:z,label:"Risk Level",color:z<30?"success.main":z<70?"warning.main":"error.main",icon:a.jsx(p,{fontSize:"small"})})})]})}),a.jsx("div",{className:"ai-analysis-section",children:a.jsx(ee,{suggestions:E})}),a.jsx("div",{className:"ai-analysis-section",children:a.jsx(ae,{commandDetails:L})}),a.jsx("div",{className:"ai-analysis-section",children:a.jsx(se,{references:R})}),a.jsx("div",{className:"ai-analysis-section",children:a.jsx(te,{examples:O||[]})}),D&&a.jsxs(x,{sx:{mt:3},children:[a.jsx(h,{expandIcon:a.jsx(u,{}),children:a.jsxs(s,{variant:"subtitle1",display:"flex",alignItems:"center",children:[a.jsx(g,{fontSize:"small",sx:{mr:1}}),"Full Analysis Details"]})}),a.jsx(y,{children:a.jsx(j,{sx:{backgroundColor:"background.paper",p:2,borderRadius:1},children:a.jsx(f,{children:D})})})]}),a.jsxs("div",{className:"ai-analysis-question-section",children:[a.jsxs(s,{variant:"subtitle1",gutterBottom:!0,display:"flex",alignItems:"center",children:[a.jsx(b,{fontSize:"small",sx:{mr:1}}),"Ask a follow-up question about this script"]}),a.jsxs("div",{className:"ai-analysis-flex-row",children:[a.jsx("div",{className:"ai-analysis-flex-grow",children:a.jsx("textarea",{value:N,onChange:e=>k(e.target.value),placeholder:"Ask about security concerns, functionality, or how to improve this script...",className:"ai-analysis-question-input"})}),a.jsx(v,{variant:"contained",color:"primary",onClick:()=>{N.trim()&&($(N),k(""))},disabled:!N.trim(),children:"Ask"})]})]})]})},re=6e4,ie=(e,a)=>{const s={message:`Failed to ${a}`,code:"UNKNOWN_ERROR",isRetryable:!1};return J.isAxiosError(e)&&("ECONNABORTED"!==e.code&&e.response?e.response&&(s.status=e.response.status,s.details=e.response.data,401===e.response.status||403===e.response.status?(s.code="AUTH_ERROR",s.message=`Authentication error while ${a}. Please check your API key.`,s.isRetryable=!1):429===e.response.status?(s.code="RATE_LIMIT",s.message=`Rate limit exceeded while ${a}`,s.isRetryable=!0):404===e.response.status&&(s.code="NOT_FOUND",s.message=`The requested resource at ${e.config?.url} was not found`,s.isRetryable=!1,s.details={originalError:e},console.error("API 404 error:",e))):(s.message=`Network error while ${a}: ${e.message}`,s.code="NETWORK_ERROR",s.isRetryable=!0)),console.error("AI service error ("+a+"):",s),s},le=async(e,a,s=3,t=1e3)=>{let n=null;for(let i=0;i<=s;i++)try{return await e()}catch(r){const e=ie(r,a);if(n=e,!e.isRetryable||i===s)throw e;console.warn(`Retry ${i+1}/${s} for ${a} (${e.code})`),await new Promise(e=>setTimeout(e,t*(i+1)))}throw n||new Error(`Unknown error in ${a}`)},oe=P(c)(({theme:e})=>({padding:e.spacing(2),marginBottom:e.spacing(2),maxWidth:"85%",borderRadius:"12px"})),ce=P(oe)(({theme:e})=>({backgroundColor:e.palette.primary.main,color:e.palette.primary.contrastText,marginLeft:"auto",position:"relative","&::after":{content:'""',position:"absolute",bottom:"8px",right:"-12px",width:"20px",height:"20px",backgroundColor:e.palette.primary.main,clipPath:"polygon(0 0, 0% 100%, 100% 50%)",transform:"rotate(-45deg)"}})),de=P(oe)(({theme:e})=>({backgroundColor:e.palette.background.paper,border:`1px solid ${e.palette.divider}`,marginRight:"auto",position:"relative","&::after":{content:'""',position:"absolute",bottom:"8px",left:"-12px",width:"20px",height:"20px",backgroundColor:e.palette.background.paper,clipPath:"polygon(0 50%, 100% 0, 100% 100%)",transform:"rotate(-45deg)",borderLeft:`1px solid ${e.palette.divider}`,borderBottom:`1px solid ${e.palette.divider}`}})),me=P(oe)(({theme:e})=>({backgroundColor:e.palette.grey[100],color:e.palette.text.secondary,margin:"0 auto",fontSize:"0.9rem",padding:e.spacing(1.5),fontStyle:"italic"})),pe=({language:e,value:s})=>a.jsxs(j,{position:"relative",mb:2,mt:1,children:[a.jsx(j,{position:"absolute",top:8,right:8,zIndex:1,children:a.jsx(R,{title:"Copy code",children:a.jsx(O,{size:"small",onClick:()=>navigator.clipboard.writeText(s),sx:{color:"white",opacity:.7,"&:hover":{opacity:1}},children:a.jsx(D,{fontSize:"small"})})})}),a.jsx(k,{language:e||"powershell",style:C,wrapLines:!0,wrapLongLines:!0,customStyle:{borderRadius:"4px"},children:s})]}),xe=({activeScript:t,onScriptGenerated:n})=>{const[r,c]=e.useState([]),[d,p]=e.useState(""),[x,h]=e.useState(!1),u=e.useRef(null),g=e.useRef(null);e.useEffect(()=>{c([{id:"welcome",role:"assistant",content:"How can I assist you with PowerShell scripts today? Ask me to explain, create, or modify scripts for you.",timestamp:new Date}])},[]),e.useEffect(()=>{u.current&&u.current.scrollIntoView({behavior:"smooth"})},[r]),e.useEffect(()=>{g.current&&g.current.focus()},[]);const y=async e=>{if(e&&e.preventDefault(),!d.trim())return;const a={id:`user-${Date.now()}`,role:"user",content:d,timestamp:new Date},s=`assistant-${Date.now()}`,r={id:s,role:"assistant",content:"",timestamp:new Date,isLoading:!0};c(e=>[...e,a,r]),p(""),h(!0);try{const e=await(async(e,a)=>le(async()=>{const{data:s}=await X.post("/scripts/please",{question:e,context:a,useAgent:!0},{timeout:re});return s.response},"ask AI agent question"))(d,t),a=d.toLowerCase().includes("generate")&&d.toLowerCase().includes("script"),r=/```powershell\n([\s\S]*?)```/,i=e.match(r),l=i?i[1]:null;l&&n&&a&&n(l),c(a=>a.map(a=>a.id===s?{...a,content:e,isLoading:!1,metadata:{internet:e.includes("Based on information from the internet")||e.includes("According to online resources"),command:l?"true":"false"}}:a))}catch(i){c(e=>e.map(e=>e.id===s?{...e,content:"Sorry, there was an error processing your request. Please try again.",isLoading:!1,isError:!0}:e)),console.error("Error in ask endpoint:",i)}finally{h(!1)}},b=e=>"system"===e.role?a.jsx(me,{children:a.jsx(s,{variant:"body2",children:e.content})}):"user"===e.role?a.jsx(ce,{children:a.jsx(s,{variant:"body1",children:e.content})}):e.isLoading?a.jsx(de,{children:a.jsxs(j,{display:"flex",alignItems:"center",gap:1,children:[a.jsx(w,{size:20}),a.jsx(s,{variant:"body2",color:"text.secondary",children:"Thinking..."})]})}):e.isError?a.jsx(de,{children:a.jsx(i,{severity:"error",sx:{mb:0},children:e.content})}):a.jsxs(de,{children:[a.jsx(j,{mb:e.metadata?2:0,children:a.jsx(f,{components:{code({node:e,inline:s,className:t,children:n,...r}){const i=/language-(\w+)/.exec(t||"");return!s&&i?a.jsx(pe,{language:i[1],value:String(n).replace(/\n$/,"")}):a.jsx("code",{className:t,...r,children:n})}},children:e.content})}),e.metadata&&a.jsxs(j,{display:"flex",gap:1,mt:1,children:[e.metadata.internet&&a.jsx(R,{title:"Used internet search to gather information",children:a.jsx(N,{icon:a.jsx(l,{fontSize:"small"}),label:"Web Research",size:"small",variant:"outlined",color:"primary"})}),e.metadata.command&&a.jsx(R,{title:"Contains executable PowerShell commands",children:a.jsx(N,{icon:a.jsx(m,{fontSize:"small"}),label:"Script Generated",size:"small",variant:"outlined",color:"secondary"})}),e.metadata.source&&a.jsx(R,{title:`Source: ${e.metadata.source}`,children:a.jsx(N,{icon:a.jsx(I,{fontSize:"small"}),label:"Reference",size:"small",variant:"outlined"})})]})]});return a.jsx(A,{children:a.jsxs(z,{children:[a.jsx(s,{variant:"h6",gutterBottom:!0,children:"PowerShell AI Assistant"}),a.jsx(s,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Ask me anything about PowerShell scripting. I can create scripts, explain commands, suggest improvements, and provide examples. I'll use internet research when needed."}),a.jsx(o,{sx:{mb:3}}),a.jsxs(j,{sx:{height:"400px",overflowY:"auto",mb:3,p:1,bgcolor:"background.default",borderRadius:1},children:[r.map(e=>a.jsx(j,{sx:{display:"flex",flexDirection:"column",mb:2},children:b(e)},e.id)),a.jsx(j,{ref:u})]}),a.jsxs(j,{mb:2,children:[a.jsx(s,{variant:"caption",color:"text.secondary",display:"block",mb:1,children:"Suggested questions:"}),a.jsx(j,{display:"flex",gap:1,flexWrap:"wrap",children:(t?["Explain what this script does","What security concerns exist in this script?","How can I make this script more efficient?","Generate documentation for this script"]:["Generate a script to monitor system performance","Create a script to manage user accounts","How do I parse log files with PowerShell?","Generate a script to back up important files"]).map((e,s)=>a.jsx(N,{label:e,size:"small",onClick:()=>(e=>{p(e),g.current&&g.current.focus()})(e),sx:{mb:1}},s))})]}),a.jsx("form",{onSubmit:y,children:a.jsxs(j,{display:"flex",gap:1,children:[a.jsx(E,{inputRef:g,fullWidth:!0,variant:"outlined",placeholder:"Ask me about PowerShell scripting...",value:d,onChange:e=>p(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),y())},disabled:x,multiline:!0,maxRows:4,size:"small"}),a.jsx(v,{variant:"contained",color:"primary",type:"submit",disabled:!d.trim()||x,startIcon:x?a.jsx(w,{size:20}):a.jsx(L,{}),children:"Send"})]})}),t&&a.jsx(j,{mt:2,children:a.jsx(s,{variant:"caption",color:"text.secondary",children:"Providing answers based on your current script context."})})]})})},he=({examples:t,isLoading:n,loadMore:r,hasMore:i=!1,onSelectExample:l,onRateExample:d})=>{const[m,p]=e.useState(0),[x,h]=e.useState({}),u=(e,a)=>{void 0===x[e]&&(h(s=>({...s,[e]:a})),d&&d(e,a))};return n&&0===t.length?a.jsxs(c,{className:"loading-paper",children:[a.jsx(w,{size:30,className:"loading-spinner"}),a.jsx(s,{variant:"body1",className:"loading-text",children:"Looking for relevant PowerShell script examples..."})]}):n||0!==t.length?a.jsxs(j,{className:"script-examples-viewer",children:[a.jsxs(j,{className:"header",mb:2,display:"flex",alignItems:"center",justifyContent:"space-between",children:[a.jsx(s,{variant:"h6",className:"header-title",children:"Script Examples"}),a.jsx(N,{label:`${t.length} found`,size:"small",color:"primary",variant:"outlined",className:"header-chip"})]}),a.jsx(B,{value:m,onChange:(e,a)=>{p(a)},variant:"scrollable",scrollButtons:"auto",className:"tabs",children:t.map((e,s)=>a.jsx(M,{label:e.title,id:`script-tab-${s}`,"aria-controls":`script-tabpanel-${s}`,className:"tab"},e.id))}),t.map((e,t)=>a.jsx(j,{role:"tabpanel",hidden:m!==t,id:`script-tabpanel-${t}`,"aria-labelledby":`script-tab-${t}`,className:"tabpanel",children:m===t&&a.jsxs(c,{variant:"outlined",className:"tabpanel-paper",children:[a.jsxs(j,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,className:"tabpanel-header",children:[a.jsxs(j,{children:[a.jsx(s,{variant:"h6",className:"tabpanel-title",children:e.title}),a.jsxs(j,{display:"flex",gap:.5,mt:1,flexWrap:"wrap",className:"tabpanel-tags",children:[e.tags.map((e,s)=>a.jsx(N,{label:e,size:"small",variant:"outlined",className:"tabpanel-tag"},s)),void 0!==e.similarity&&a.jsx(N,{icon:a.jsx(T,{fontSize:"small"}),label:`${Math.round(100*e.similarity)}% match`,size:"small",color:"primary",className:"tabpanel-similarity"})]})]}),a.jsxs(j,{className:"tabpanel-actions",children:[a.jsx(R,{title:"Copy to clipboard",children:a.jsx(O,{size:"small",onClick:()=>{return a=e.script,void navigator.clipboard.writeText(a);var a},className:"tabpanel-action-button",children:a.jsx(D,{fontSize:"small"})})}),a.jsx(R,{title:"Download script",children:a.jsx(O,{size:"small",onClick:()=>((e,a)=>{const s=document.createElement("a"),t=new Blob([e],{type:"text/plain"});s.href=URL.createObjectURL(t),s.download=`${a.replace(/\s+/g,"-").toLowerCase()}.ps1`,document.body.appendChild(s),s.click(),document.body.removeChild(s)})(e.script,e.title),className:"tabpanel-action-button",children:a.jsx(G,{fontSize:"small"})})})]})]}),e.description&&a.jsx(s,{variant:"body2",paragraph:!0,className:"tabpanel-description",children:e.description}),e.source&&a.jsxs(s,{variant:"caption",color:"text.secondary",display:"block",mb:1,className:"tabpanel-source",children:["Source: ",e.source,e.url&&a.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"tabpanel-source-link",children:"View Original"})]}),a.jsx(o,{className:"tabpanel-divider"}),a.jsx(k,{language:"powershell",style:C,wrapLines:!0,wrapLongLines:!0,customStyle:{borderRadius:"4px"},className:"tabpanel-code",children:e.script}),a.jsxs(j,{display:"flex",justifyContent:"space-between",alignItems:"center",mt:2,className:"tabpanel-footer",children:[l&&a.jsx(v,{variant:"contained",onClick:()=>l(e),className:"tabpanel-use-script-button",children:"Use This Script"}),a.jsxs(j,{className:"tabpanel-rating",children:[a.jsx(s,{variant:"caption",color:"text.secondary",mr:1,className:"tabpanel-rating-text",children:"Was this helpful?"}),a.jsx(R,{title:"Helpful",children:a.jsx(O,{size:"small",onClick:()=>u(e.id,"helpful"),color:"helpful"===x[e.id]?"primary":"default",disabled:void 0!==x[e.id],className:"tabpanel-rating-button",children:a.jsx(W,{fontSize:"small"})})}),a.jsx(R,{title:"Not helpful",children:a.jsx(O,{size:"small",onClick:()=>u(e.id,"unhelpful"),color:"unhelpful"===x[e.id]?"error":"default",disabled:void 0!==x[e.id],className:"tabpanel-rating-button",children:a.jsx(F,{fontSize:"small"})})})]})]})]})},e.id)),i&&a.jsx(j,{display:"flex",justifyContent:"center",mt:2,className:"load-more-button-container",children:a.jsx(v,{variant:"outlined",onClick:r,disabled:n,startIcon:n?a.jsx(w,{size:20}):null,className:"load-more-button",children:n?"Loading...":"Load More Examples"})})]}):a.jsx(c,{className:"no-examples-paper",children:a.jsx(s,{variant:"body1",color:"text.secondary",className:"no-examples-text",children:"No script examples found. Try modifying your search criteria."})})},ue=({value:s,onChange:t,language:n="powershell",height:r="500px",readOnly:i=!1})=>{const l={selectOnLineNumbers:!0,roundedSelection:!0,readOnly:i,cursorStyle:"line",automaticLayout:!0,minimap:{enabled:!0},scrollBeyondLastLine:!1,wordWrap:"on",lineNumbers:"on",folding:!0,fontSize:14},o=e.useRef(null);return e.useEffect(()=>{o.current&&o.current.style.setProperty("--editor-height","string"==typeof r?r:`${r}px`)},[r]),a.jsx("div",{className:"code-editor-container",ref:o,children:a.jsx(_,{width:"100%",height:"100%",language:n,theme:"vs-dark",value:s,options:l,onChange:t,editorDidMount:e=>{e.focus()}})})},ge=async(e,a,s,t=!0)=>{console.log("Starting AI agent workflow analysis");const n={isLoading:!0,analysis:null,examples:[],error:null,isExamplesLoading:!1};try{try{const r=await(async(e,a)=>{const s={};return a&&(s["x-openai-api-key"]=a),le(async()=>{const{data:a}=await X.post("/scripts/analyze/assistant",e,{headers:s,timeout:re});return a},"analyze script with AI agent")})({content:e,filename:a,requestType:"detailed",analysisOptions:{includeSimilarScripts:!0,includeInternetSearch:t,maxExamples:5}},s);n.analysis=r,r?.analysis?.examples?.length>0&&(n.examples=r.analysis.examples)}catch(r){console.error("Error in AI analysis:",r),r instanceof Error?n.error=`Analysis error: ${r.message}`:n.error="Failed to analyze script with AI"}return n}catch(r){throw console.error("Error in AI agent workflow:",r),r}finally{n.isLoading=!1}},ye=e=>{const{children:s,value:t,index:n,...r}=e;return a.jsx("div",{role:"tabpanel",hidden:t!==n,id:`ai-workflow-tabpanel-${n}`,"aria-labelledby":`ai-workflow-tab-${n}`,...r,className:"agentic-ai-tab-panel",children:t===n&&a.jsx(j,{className:"agentic-ai-tab-panel-content",children:s})})},je=P(c)(({theme:e})=>({padding:e.spacing(3),marginBottom:e.spacing(3),position:"relative",overflow:"hidden"})),fe=[{id:"ex1",title:"System Information Collector",description:"Collects detailed system information including OS, hardware, and installed software.",script:'# System Information Collector\n# Gathers detailed information about the system\n\nfunction Get-SystemDetails {\n    $computerSystem = Get-CimInstance CIM_ComputerSystem\n    $operatingSystem = Get-CimInstance CIM_OperatingSystem\n    $processor = Get-CimInstance CIM_Processor\n    $physicalMemory = Get-CimInstance CIM_PhysicalMemory | Measure-Object -Property Capacity -Sum\n    $diskDrives = Get-CimInstance CIM_DiskDrive\n    \n    $systemInfo = [PSCustomObject]@{\n        ComputerName = $computerSystem.Name\n        Manufacturer = $computerSystem.Manufacturer\n        Model = $computerSystem.Model\n        OperatingSystem = $operatingSystem.Caption\n        OSVersion = $operatingSystem.Version\n        OSBuild = $operatingSystem.BuildNumber\n        Processor = $processor.Name\n        CPUCores = $processor.NumberOfCores\n        MemoryGB = [math]::Round($physicalMemory.Sum / 1GB, 2)\n        DiskCount = $diskDrives.Count\n        TotalDiskSizeGB = [math]::Round(($diskDrives | Measure-Object -Property Size -Sum).Sum / 1GB, 2)\n        LastBootTime = $operatingSystem.LastBootUpTime\n        InstallDate = $operatingSystem.InstallDate\n    }\n    \n    return $systemInfo\n}\n\n# Get system information\n$systemInfo = Get-SystemDetails\n\n# Display the results\n$systemInfo | Format-List\n\n# Optional: Export to file\n# $systemInfo | Export-Csv -Path "$env:USERPROFILE\\Desktop\\SystemInfo.csv" -NoTypeInformation',tags:["System","Hardware","Information"],similarity:.92},{id:"ex2",title:"Log Parser",description:"Parses log files and extracts warnings and errors.",script:'# Log Parser\n# Extracts warnings and errors from log files\nparam(\n    [Parameter(Mandatory=$true)]\n    [string]$LogPath,\n    \n    [Parameter(Mandatory=$false)]\n    [string]$OutputPath = "$env:USERPROFILE\\Desktop\\LogResults.csv",\n    \n    [string[]]$Patterns = @("ERROR", "WARN", "EXCEPTION", "FAIL")\n)\n\nfunction Parse-Logs {\n    param(\n        [string]$LogPath,\n        [string[]]$Patterns\n    )\n    \n    if (!(Test-Path -Path $LogPath)) {\n        Write-Error "Log path not found: $LogPath"\n        return $null\n    }\n    \n    $logs = Get-ChildItem -Path $LogPath -Filter "*.log" -Recurse\n    \n    $results = @()\n    \n    foreach ($log in $logs) {\n        Write-Host "Processing $($log.FullName)..."\n        \n        $lineNumber = 0\n        $content = Get-Content -Path $log.FullName\n        \n        foreach ($line in $content) {\n            $lineNumber++\n            \n            foreach ($pattern in $Patterns) {\n                if ($line -match $pattern) {\n                    $results += [PSCustomObject]@{\n                        LogFile = $log.Name\n                        LineNumber = $lineNumber\n                        Pattern = $pattern\n                        Line = $line\n                        Timestamp = if ($line -match \'\\d{4}-\\d{2}-\\d{2}\') { $matches[0] } else { "Not found" }\n                    }\n                    break\n                }\n            }\n        }\n    }\n    \n    return $results\n}\n\n# Parse logs\n$results = Parse-Logs -LogPath $LogPath -Patterns $Patterns\n\n# Display summary\nWrite-Host "Found $($results.Count) matches across $($results | Select-Object -Unique LogFile | Measure-Object).Count files."\n\n# Export results\nif ($results.Count -gt 0) {\n    $results | Export-Csv -Path $OutputPath -NoTypeInformation\n    Write-Host "Results exported to $OutputPath"\n}',tags:["Logs","Parser","Monitoring"],similarity:.85,source:"PowerShell Community Scripts"}],be=()=>{const[t,r]=e.useState(0),[c,d]=e.useState(""),[p,x]=e.useState(""),[h,u]=e.useState(null),[g,y]=e.useState(!1),[f,b]=e.useState(null),[S,I]=e.useState([]),[$,N]=e.useState(!1),[k,C]=e.useState(""),[P,A]=e.useState(!1),[z,L]=e.useState({open:!1,message:"",severity:"info"}),[R,D]=e.useState(""),[T,G]=e.useState(!1);e.useEffect(()=>{if({}.VITE_OPENAI_API_KEY)console.log("Environment variable OpenAI API key detected"),G(!0);else{console.log("No environment variable OpenAI API key found, checking localStorage");const e=localStorage.getItem("openai_api_key");e?(console.log("Found OpenAI API key in localStorage"),D(e)):console.log("No API key found in localStorage")}I(fe)},[]);const W=()=>{const e={}.VITE_OPENAI_API_KEY;return e||(R||void 0)},F=()=>{L({...z,open:!1})},_=e=>{r(3),L({open:!0,message:"Question sent to AI Assistant",severity:"info"})};return a.jsxs(U,{maxWidth:"xl",className:"agentic-ai-container",children:[a.jsx(s,{variant:"h4",gutterBottom:!0,children:"PowerShell AI Assistant"}),a.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[a.jsx(s,{variant:"body1",color:"text.secondary",children:"Use our agentic AI workflows to analyze, generate, and understand PowerShell scripts."}),a.jsx(v,{variant:"outlined",size:"small",component:q,to:"/settings/api",startIcon:a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:[a.jsx("path",{d:"M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"}),a.jsx("path",{d:"M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z"})]}),children:"API Settings"})]}),a.jsx(j,{sx:{borderBottom:1,borderColor:"divider"},children:a.jsxs(B,{value:t,onChange:(e,a)=>{r(a)},"aria-label":"AI workflow tabs",variant:"scrollable",scrollButtons:"auto",children:[a.jsx(M,{icon:a.jsx(l,{}),label:"Examples",id:"ai-workflow-tab-0","aria-controls":"ai-workflow-tabpanel-0"}),a.jsx(M,{icon:a.jsx(m,{}),label:"Script Editor",id:"ai-workflow-tab-1","aria-controls":"ai-workflow-tabpanel-1"}),a.jsx(M,{icon:a.jsx(H,{}),label:"AI Analysis",id:"ai-workflow-tab-2","aria-controls":"ai-workflow-tabpanel-2"}),a.jsx(M,{icon:a.jsx(K,{}),label:"AI Assistant",id:"ai-workflow-tab-3","aria-controls":"ai-workflow-tabpanel-3"})]})}),a.jsxs(j,{className:"agentic-ai-tab-content",children:[a.jsx(ye,{value:t,index:0,children:a.jsxs(n,{container:!0,spacing:3,children:[a.jsx(n,{item:!0,xs:12,lg:4,children:a.jsxs(je,{className:"agentic-ai-paper",children:[a.jsx(s,{variant:"h6",gutterBottom:!0,children:"Generate a Script"}),a.jsx(s,{variant:"body2",paragraph:!0,children:"Describe what you want the script to do, and our AI will generate a PowerShell script for you."}),a.jsx(E,{fullWidth:!0,label:"Describe the script you need",multiline:!0,rows:4,value:k,onChange:e=>C(e.target.value),placeholder:"E.g., Create a script that monitors CPU and memory usage and sends an email alert when thresholds are exceeded",variant:"outlined",className:"generation-prompt-field"}),a.jsx(v,{variant:"contained",fullWidth:!0,onClick:async()=>{if(k.trim()){A(!0);try{const e=await(async(e,a)=>{const s={};return a&&(s["x-openai-api-key"]=a),le(async()=>{const{data:a}=await X.post("/scripts/generate",{description:e},{headers:s,timeout:re});return a.content},"generate script")})(k,W());e&&(d(e),x(k.split(" ").slice(0,3).join("-")+".ps1"),r(1),L({open:!0,message:"Script generated successfully! You can now edit it in the editor.",severity:"success"}))}catch(e){console.error("Error generating script:",e),L({open:!0,message:"Error generating script. Please try again.",severity:"error"})}finally{A(!1)}}else L({open:!0,message:"Please enter a description of the script you want to generate",severity:"warning"})},disabled:P||!k.trim(),startIcon:P?a.jsx(w,{size:20}):null,children:P?"Generating...":"Generate Script"}),a.jsx(o,{className:"agentic-ai-divider"}),a.jsx(s,{variant:"h6",gutterBottom:!0,children:"Upload a Script"}),a.jsx(s,{variant:"body2",paragraph:!0,children:"Upload your own PowerShell script to edit or analyze."}),a.jsxs(v,{variant:"outlined",component:"label",fullWidth:!0,startIcon:a.jsx(Q,{}),children:["Upload Script",a.jsx("input",{type:"file",hidden:!0,accept:".ps1",onChange:e=>{const a=e.target.files?.[0];if(a){const e=new FileReader;e.onload=e=>{const s=e.target?.result;d(s),x(a.name)},e.readAsText(a)}}})]})]})}),a.jsx(n,{item:!0,xs:12,lg:8,children:a.jsx(je,{className:"agentic-ai-paper",children:a.jsx(he,{examples:S,isLoading:$,onSelectExample:e=>{d(e.script),x(e.title.toLowerCase().replace(/\s+/g,"-")+".ps1"),r(1),L({open:!0,message:`Example script "${e.title}" loaded into the editor`,severity:"success"})}})})})]})}),a.jsx(ye,{value:t,index:1,children:a.jsxs(je,{className:"editor-paper",children:[a.jsxs(j,{className:"agentic-ai-header",children:[a.jsxs(j,{children:[a.jsx(s,{variant:"h6",children:"Script Editor"}),a.jsx(E,{size:"small",value:p,onChange:e=>x(e.target.value),placeholder:"script.ps1",className:"script-name-field"})]}),a.jsxs(j,{children:[a.jsx(v,{variant:"contained",onClick:async()=>{if(c.trim()){y(!0),b(null);try{const e=await ge(c,p||"script.ps1",W(),!1);if(u(e.analysis),e.error&&b(e.error),e.examples.length>0){const a=e.examples.map((e,a)=>({id:`gen-${a}`,title:e.title||`Example ${a+1}`,description:e.description||"",script:e.script||"",tags:e.tags||[],similarity:e.similarity||.5,source:"AI Generated"}));I(a)}}catch(e){b(e instanceof Error?e.message:"An error occurred during analysis"),console.error("Error analyzing script:",e)}finally{y(!1)}}else L({open:!0,message:"Please enter a script to analyze",severity:"warning"})},disabled:g||!c.trim(),startIcon:g?a.jsx(w,{size:20}):null,className:"analyze-button",children:g?"Analyzing...":"Analyze with AI"}),a.jsx(v,{variant:"outlined",onClick:()=>_(),disabled:!c.trim(),className:"ask-button",children:"Ask AI Assistant"})]})]}),a.jsx(o,{className:"agentic-ai-divider"}),a.jsx(j,{className:"agentic-ai-editor-container",children:a.jsx(ue,{value:c,onChange:d,language:"powershell",height:"100%"})})]})}),a.jsx(ye,{value:t,index:2,children:a.jsx(je,{className:"agentic-ai-paper",children:a.jsx(ne,{analysis:h,isLoading:g,error:f,onAskQuestion:_})})}),a.jsx(ye,{value:t,index:3,children:a.jsx(je,{className:"agentic-ai-paper",children:a.jsx(xe,{activeScript:c,onScriptGenerated:e=>{d(e),x("assistant-generated.ps1"),r(1),L({open:!0,message:"Script generated by AI Assistant loaded into the editor",severity:"success"})}})})})]}),a.jsx(V,{open:z.open,autoHideDuration:6e3,onClose:F,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:a.jsx(i,{onClose:F,severity:z.severity,sx:{width:"100%"},action:a.jsx(O,{size:"small","aria-label":"close",color:"inherit",onClick:F,children:a.jsx(Y,{fontSize:"small"})}),children:z.message})})]})};export{be as default};
