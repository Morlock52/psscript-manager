import{r as e,j as s,_ as t,g as r,u as l,V as a}from"./react-vendor-chunk-814f15fe.js";import{u as i,d as n}from"./data-fetching-chunk-acdfbf86.js";import{L as c,s as d}from"../assets/index-c161c383.js";import"./editor-chunk-85777d73.js";const o=({scriptContent:t,scriptTitle:r,className:l="",variant:a="primary",size:i="md",showOptions:n=!1})=>{const[c,d]=e.useState(!1),o=()=>`rounded ${{sm:"px-2 py-1 text-sm",md:"px-3 py-2",lg:"px-4 py-2 text-lg"}[i]} ${{primary:"bg-blue-600 hover:bg-blue-700 text-white",secondary:"bg-gray-600 hover:bg-gray-700 text-white",outline:"bg-transparent border border-blue-600 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900 dark:text-blue-400 dark:border-blue-400"}[a]} transition-colors ${l}`,x=()=>{((e,s)=>{const t=new Blob([e],{type:"text/plain"}),r=URL.createObjectURL(t),l=document.createElement("a");l.href=r,l.download=`${s.replace(/\s+/g,"_")}.ps1`,document.body.appendChild(l),l.click(),URL.revokeObjectURL(r),document.body.removeChild(l)})(t,r)};return n?s.jsxs("div",{className:"relative inline-block",children:[s.jsx("button",{className:o(),onClick:()=>d(!c),"aria-expanded":c,"aria-haspopup":"true",children:s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),s.jsx("span",{children:"Download"}),s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),c&&s.jsx("div",{className:"absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5 z-50",children:s.jsxs("div",{className:"py-1",role:"menu","aria-orientation":"vertical",children:[s.jsx("button",{className:"w-full text-left block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:x,role:"menuitem",children:"Download as .ps1 Script"}),s.jsx("button",{className:"w-full text-left block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>{((e,s)=>{const t=new Blob([e],{type:"text/plain"}),r=URL.createObjectURL(t),l=document.createElement("a");l.href=r,l.download=`${s.replace(/\s+/g,"_")}.psm1`,document.body.appendChild(l),l.click(),URL.revokeObjectURL(r),document.body.removeChild(l)})(t,r),d(!1)},role:"menuitem",children:"Download as .psm1 Module"})]})}),c&&s.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>d(!1)})]}):s.jsx("button",{className:o(),onClick:x,"aria-label":"Download script",children:s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),s.jsx("span",{children:"Download"})]})})},x=e.lazy(()=>t(()=>import("./react-vendor-chunk-814f15fe.js").then(e=>e.ii),["js/react-vendor-chunk-814f15fe.js","js/editor-chunk-85777d73.js","assets/editor-6eda2c60.css","assets/react-vendor-5e8f3fb6.css"])),m=()=>s.jsx("div",{className:"flex items-center justify-center h-full bg-gray-100 rounded-lg",children:s.jsx(c,{message:"Loading code editor...",size:"large"})}),h=t=>s.jsx(e.Suspense,{fallback:s.jsx(m,{}),children:s.jsx(x,{...t})}),g=({isOpen:t,onClose:r,initialContent:l,onSave:a,title:i="Edit Script",scriptName:n=""})=>{const[c,d]=e.useState(l),[o,x]=e.useState(!1),[m,g]=e.useState(!1);e.useRef(null);const u=e.useRef(null);e.useEffect(()=>{d(l);const e=e=>{"Escape"===e.key&&r()},s=e=>{(e.metaKey||e.ctrlKey)&&"s"===e.key&&(e.preventDefault(),p())};return t&&(document.addEventListener("keydown",e),document.addEventListener("keydown",s)),()=>{document.removeEventListener("keydown",e),document.removeEventListener("keydown",s)}},[t,l,r,c]),e.useEffect(()=>{const e=e=>{u.current&&!u.current.contains(e.target)&&r()};return t&&setTimeout(()=>{document.addEventListener("mousedown",e)},100),()=>{document.removeEventListener("mousedown",e)}},[t,r]);const p=()=>{x(!0);try{a(c),setTimeout(()=>{x(!1),g(!0),setTimeout(()=>g(!1),2e3)},500)}catch(e){console.error("Error saving script:",e),x(!1)}};return t?s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-80",children:s.jsxs("div",{ref:u,className:"bg-gray-800 rounded-lg shadow-xl w-11/12 h-5/6 flex flex-col",children:[s.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-gray-700",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("h2",{className:"text-xl font-semibold text-white",children:i}),n&&s.jsx("span",{className:"ml-2 text-gray-400 text-sm",children:n}),m&&s.jsx("span",{className:"ml-3 text-green-400 text-sm bg-green-900 px-2 py-1 rounded animate-pulse",children:"Saved successfully!"})]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("button",{onClick:p,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition flex items-center "+(o?"opacity-70 cursor-not-allowed":""),disabled:o,children:o?s.jsxs(s.Fragment,{children:[s.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):"Save"}),s.jsx("button",{onClick:r,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition",children:"Cancel"})]})]}),s.jsx("div",{className:"flex-grow overflow-hidden",children:s.jsx(h,{language:"powershell",theme:"vs-dark",value:c,options:{selectOnLineNumbers:!0,roundedSelection:!1,readOnly:!1,cursorStyle:"line",automaticLayout:!0,minimap:{enabled:!0},scrollBeyondLastLine:!1,contextmenu:!0,fontFamily:'Consolas, "Courier New", monospace',fontSize:14,lineNumbers:"on",wordWrap:"on",quickSuggestions:!0,snippetSuggestions:"inline",formatOnPaste:!0,formatOnType:!0},onChange:d,height:"100%",width:"100%"})}),s.jsxs("div",{className:"p-2 border-t border-gray-700 bg-gray-900 text-xs text-gray-400 flex justify-between",children:[s.jsxs("div",{children:["Press ",s.jsx("kbd",{className:"px-1 py-0.5 bg-gray-700 rounded",children:"Ctrl+S"})," or ",s.jsx("kbd",{className:"px-1 py-0.5 bg-gray-700 rounded",children:"⌘+S"})," to save"]}),s.jsxs("div",{children:[s.jsxs("span",{className:"mr-4",children:[s.jsx("kbd",{className:"px-1 py-0.5 bg-gray-700 rounded",children:"Alt+Shift+F"})," Format"]}),s.jsxs("span",{children:[s.jsx("kbd",{className:"px-1 py-0.5 bg-gray-700 rounded",children:"Esc"})," Close"]})]})]})]})}):null},u=()=>{const{id:t}=r(),c=l(),[x,m]=e.useState({}),[h,u]=e.useState(!1),[p,y]=e.useState(!1),{data:b,isLoading:j,error:v,refetch:N}=i({queryKey:["script",t],queryFn:()=>d.getScript(t||""),enabled:!!t,refetchOnWindowFocus:!1}),{data:w,error:f}=i({queryKey:["scriptAnalysis",t],queryFn:()=>d.getScriptAnalysis(t||""),enabled:!!t,refetchOnWindowFocus:!1,retry:!1,select:e=>e}),k=n({mutationFn:e=>d.executeScript(t||"",e),onSuccess:e=>{console.log("Script executed successfully:",e)}}),S=n({mutationFn:e=>d.updateScript(t||"",{content:e}),onSuccess:()=>{N()}}),C=n({mutationFn:()=>d.analyzeScriptAndSave(t||""),onSuccess:e=>{a.success("Script analyzed successfully"),c(`/scripts/${t}/analysis`)},onError:e=>{console.error("Error analyzing script:",e),a.error("Failed to analyze script")},onSettled:()=>{y(!1)}}),_=()=>{y(!0),C.mutate()};return j?s.jsx("div",{className:"flex justify-center items-center h-96",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):v||!b?s.jsxs("div",{className:"bg-gray-700 rounded-lg p-8 shadow text-center",children:[s.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Script Not Found"}),s.jsx("p",{className:"text-gray-300 mb-6",children:"The script you are looking for does not exist or you don't have permission to view it."}),s.jsx("button",{onClick:()=>c("/scripts"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Back to Scripts"})]}):s.jsxs("div",{className:"container mx-auto pb-8",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-2xl font-bold",children:b.title}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx(o,{scriptContent:b.content,scriptTitle:b.title,showOptions:!0,variant:"primary"}),s.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",onClick:()=>{u(!0)},children:"Edit"}),s.jsx("button",{className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 flex items-center",onClick:_,disabled:p,children:p?s.jsxs(s.Fragment,{children:[s.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Analyzing..."]}):"Analyze with AI"}),s.jsx("button",{className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",onClick:()=>c("/scripts"),children:"Back to Scripts"}),s.jsx("button",{className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",onClick:()=>c("/"),children:"Dashboard"})]})]}),s.jsx(g,{isOpen:h,onClose:()=>u(!1),initialContent:b.content,onSave:e=>{S.mutate(e)},title:"Edit PowerShell Script",scriptName:b.title}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"lg:col-span-2",children:[s.jsxs("div",{className:"bg-gray-700 rounded-lg shadow overflow-hidden mb-6",children:[s.jsxs("div",{className:"p-4 bg-gray-800 border-b border-gray-600 flex justify-between items-center",children:[s.jsx("h2",{className:"text-lg font-medium",children:"Script Content"}),s.jsxs("div",{className:"text-xs text-gray-400",children:["Version ",b.version," | Updated ",new Date(b.updatedAt).toLocaleDateString()]})]}),s.jsx("div",{className:"p-0",children:s.jsx("pre",{className:"p-4 text-sm font-mono text-gray-300 overflow-x-auto max-h-96",children:b.content})})]}),w?.parameters&&Object.keys(w.parameters).length>0&&s.jsxs("div",{className:"bg-gray-700 rounded-lg shadow mb-6",children:[s.jsx("div",{className:"p-4 bg-gray-800 border-b border-gray-600",children:s.jsx("h2",{className:"text-lg font-medium",children:"Execute Script"})}),s.jsxs("div",{className:"p-4",children:[s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.entries(w.parameters).map(([e,t])=>s.jsxs("div",{className:"space-y-2",children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-300",children:[e,t.mandatory&&s.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),s.jsx("input",{type:"text",className:"w-full bg-gray-800 border border-gray-600 rounded-md text-white px-3 py-2 text-sm",placeholder:t.type||"String",value:x[e]||"",onChange:s=>((e,s)=>{m(t=>({...t,[e]:s}))})(e,s.target.value)}),t.description&&s.jsx("p",{className:"text-xs text-gray-400",children:t.description})]},e))}),s.jsx("div",{className:"mt-4 flex justify-end",children:s.jsx("button",{className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50",onClick:()=>{k.mutate(x)},disabled:k.isPending,children:k.isPending?"Executing...":"Execute Script"})})]})]}),k.data&&s.jsxs("div",{className:"bg-gray-700 rounded-lg shadow mb-6",children:[s.jsx("div",{className:"p-4 bg-gray-800 border-b border-gray-600",children:s.jsx("h2",{className:"text-lg font-medium",children:"Execution Result"})}),s.jsx("div",{className:"p-0",children:s.jsx("pre",{className:"p-4 text-sm font-mono text-gray-300 overflow-x-auto max-h-96",children:JSON.stringify(k.data,null,2)})})]})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-gray-700 rounded-lg shadow",children:[s.jsx("div",{className:"p-4 bg-gray-800 border-b border-gray-600",children:s.jsx("h2",{className:"text-lg font-medium",children:"Script Information"})}),s.jsx("div",{className:"p-4",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm text-gray-400",children:"Category"}),s.jsx("p",{className:"text-white",children:b.category?.name||"Uncategorized"})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm text-gray-400",children:"Author"}),s.jsx("p",{className:"text-white",children:b.user?.username||"Unknown"})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm text-gray-400",children:"Created"}),s.jsx("p",{className:"text-white",children:new Date(b.createdAt).toLocaleDateString()})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm text-gray-400",children:"Execution Count"}),s.jsx("p",{className:"text-white",children:b.executionCount||0})]})]})})]}),!w&&s.jsxs("div",{className:"bg-gray-700 rounded-lg shadow",children:[s.jsx("div",{className:"p-4 bg-gray-800 border-b border-gray-600",children:s.jsx("h2",{className:"text-lg font-medium",children:"AI Analysis"})}),s.jsxs("div",{className:"p-6 text-center",children:[s.jsx("p",{className:"text-gray-300 mb-4",children:"No analysis available for this script yet."}),s.jsx("button",{className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 w-full flex items-center justify-center",onClick:_,disabled:p,children:p?s.jsxs(s.Fragment,{children:[s.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Analyzing Script..."]}):"Analyze with AI"})]})]}),w&&s.jsxs("div",{className:"bg-gray-700 rounded-lg shadow",children:[s.jsxs("div",{className:"p-4 bg-gray-800 border-b border-gray-600 flex justify-between items-center",children:[s.jsx("h2",{className:"text-lg font-medium",children:"AI Analysis"}),s.jsx("button",{className:"text-xs px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:()=>window.open(`/scripts/${t}/analysis`,"_blank"),children:"View Full Analysis"})]}),s.jsx("div",{className:"p-4",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm text-gray-400",children:"Purpose"}),s.jsx("p",{className:"text-white",children:w.purpose})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm text-gray-400",children:"Quality Score"}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-full bg-gray-800 rounded-full h-2.5 mr-2",children:s.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:10*w.code_quality_score+"%"}})}),s.jsxs("span",{children:[w.code_quality_score,"/10"]})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm text-gray-400",children:"Security Score"}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-full bg-gray-800 rounded-full h-2.5 mr-2",children:s.jsx("div",{className:"h-2.5 rounded-full "+(w.security_score>7?"bg-green-500":w.security_score>4?"bg-yellow-500":"bg-red-500"),style:{width:10*w.security_score+"%"}})}),s.jsxs("span",{children:[w.security_score,"/10"]})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm text-gray-400",children:"Risk Assessment"}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-full bg-gray-800 rounded-full h-2.5 mr-2",children:s.jsx("div",{className:"h-2.5 rounded-full "+(w.risk_score<3?"bg-green-500":w.risk_score<7?"bg-yellow-500":"bg-red-500"),style:{width:10*w.risk_score+"%"}})}),s.jsxs("span",{children:[w.risk_score,"/10"]})]})]}),w.complexity_score&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm text-gray-400",children:"Complexity"}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-full bg-gray-800 rounded-full h-2.5 mr-2",children:s.jsx("div",{className:"h-2.5 rounded-full "+(w.complexity_score<4?"bg-green-500":w.complexity_score<8?"bg-yellow-500":"bg-red-500"),style:{width:10*w.complexity_score+"%"}})}),s.jsxs("span",{children:[w.complexity_score,"/10"]})]})]})]}),w.optimization_suggestions&&w.optimization_suggestions.length>0&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm text-gray-400 mb-2",children:"Optimization Suggestions"}),s.jsx("ul",{className:"list-disc pl-5 text-sm text-gray-300 space-y-1",children:w.optimization_suggestions.map((e,t)=>s.jsx("li",{children:e},t))})]}),w.security_concerns&&w.security_concerns.length>0&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm text-gray-400 mb-2",children:"Security Concerns"}),s.jsx("ul",{className:"list-disc pl-5 text-sm text-red-300 space-y-1",children:w.security_concerns.map((e,t)=>s.jsx("li",{children:e},t))})]}),w.best_practices&&w.best_practices.length>0&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm text-gray-400 mb-2",children:"Best Practices"}),s.jsx("ul",{className:"list-disc pl-5 text-sm text-blue-300 space-y-1",children:w.best_practices.map((e,t)=>s.jsx("li",{children:e},t))})]}),w.performance_suggestions&&w.performance_suggestions.length>0&&s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm text-gray-400 mb-2",children:"Performance Tips"}),s.jsx("ul",{className:"list-disc pl-5 text-sm text-green-300 space-y-1",children:w.performance_suggestions.map((e,t)=>s.jsx("li",{children:e},t))})]}),s.jsx("div",{className:"mt-3 pt-3 border-t border-gray-600",children:s.jsx("button",{className:"w-full text-center text-sm text-blue-400 hover:text-blue-300",onClick:()=>window.open(`/scripts/${t}/analysis`,"_blank"),children:"View Detailed Analysis →"})})]})})]}),null]})]})]})};export{u as default};
