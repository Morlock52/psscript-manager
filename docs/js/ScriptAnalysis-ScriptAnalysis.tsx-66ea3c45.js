import{g as e,u as s,r as t,j as r,F as i,h as a,i as l,k as n,l as c,m as d,M as o,n as m}from"./react-vendor-chunk-814f15fe.js";import{u as x,a as h}from"./data-fetching-chunk-acdfbf86.js";import{s as u}from"../assets/index-c161c383.js";import"./editor-chunk-85777d73.js";const p=()=>{const{id:p}=e(),g=s(),[y,b]=t.useState("overview"),[j,N]=t.useState([]),[f,v]=t.useState(""),[w,S]=t.useState(!1),k=t.useRef(null),{data:A,isLoading:C}=x({queryKey:["script",p],queryFn:()=>u.getScript(p||""),enabled:!!p,refetchOnWindowFocus:!1}),{data:I,isLoading:$}=x({queryKey:["scriptAnalysis",p],queryFn:()=>u.getScriptAnalysis(p||""),enabled:!!p,refetchOnWindowFocus:!1}),P=C||$;t.useEffect(()=>{"assistant"===y&&k.current&&k.current.scrollIntoView({behavior:"smooth"})},[j,y]),t.useEffect(()=>{"assistant"===y&&0===j.length&&A&&I&&N([{role:"assistant",content:`# Welcome to Psscript AI Assistant!\n\nI'm here to help you understand and improve your PowerShell script: **${A.title}**.\n\nYou can ask me questions about:\n- How specific parts of your script work\n- Security concerns and how to address them\n- Performance optimization opportunities\n- Best practices for PowerShell scripting\n- How to implement specific features\n\nWhat would you like to know about your script?`}])},[y,j.length,A,I]);const L=({className:e,children:s})=>{const t=e?e.replace("language-",""):"powershell";return r.jsxs("div",{className:"relative rounded-md overflow-hidden bg-gray-800 my-4",children:[r.jsxs("div",{className:"flex justify-between items-center px-4 py-2 text-xs border-b border-gray-700",children:[r.jsx("span",{children:t}),r.jsx("button",{onClick:()=>navigator.clipboard.writeText(String(s)),className:"px-2 py-1 rounded text-xs bg-gray-700 hover:bg-gray-600 text-gray-300",children:"Copy"})]}),r.jsx("pre",{className:"p-4 overflow-x-auto",children:r.jsx("code",{className:"text-gray-300",children:s})})]})};if(P)return r.jsx("div",{className:"flex justify-center items-center h-96",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})});if(!A)return r.jsxs("div",{className:"bg-gray-700 rounded-lg p-8 shadow text-center",children:[r.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Script Not Found"}),r.jsx("p",{className:"text-gray-300 mb-6",children:"The script you are looking for does not exist or you don't have permission to view it."}),r.jsx("button",{onClick:()=>g("/"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Back to Dashboard"})]});const M=I&&Object.keys(I).length>0,V=(e,s,t=!1)=>{const i="number"==typeof e?e:"-",a="number"==typeof e?e:0;let l="";return l=t?a<3?"text-green-400":a<7?"text-yellow-400":"text-red-400":a>7?"text-green-400":a>4?"text-yellow-400":"text-red-400",r.jsxs("div",{className:"flex flex-col items-center text-center",children:[r.jsx("span",{className:`font-bold text-2xl mb-1 ${l}`,children:"-"===i?"-":`${i}/10`}),r.jsx("span",{className:"text-sm text-gray-300",children:s})]})};return r.jsxs("div",{className:"container mx-auto pb-8",children:[r.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[r.jsxs("div",{children:[r.jsxs("h1",{className:"text-2xl font-bold",children:["AI Analysis: ",A.title]}),r.jsx("p",{className:"text-gray-400",children:"Comprehensive analysis and improvement recommendations for your PowerShell script"})]}),r.jsxs("div",{className:"flex space-x-2",children:[r.jsx("button",{className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",onClick:()=>g(`/scripts/${p}`),children:"Back to Script"}),r.jsxs("button",{className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 flex items-center space-x-2",onClick:()=>g("/"),children:[r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),r.jsx("span",{children:"Dashboard"})]})]})]}),r.jsx("div",{className:"mb-6 border-b border-gray-600",children:r.jsxs("nav",{className:"flex space-x-4 overflow-x-auto pb-px",children:[r.jsx("button",{className:"py-3 px-4 text-sm font-medium whitespace-nowrap "+("overview"===y?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-white"),onClick:()=>b("overview"),children:"Overview"}),r.jsx("button",{className:"py-3 px-4 text-sm font-medium whitespace-nowrap "+("security"===y?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-white"),onClick:()=>b("security"),children:"Security"}),r.jsx("button",{className:"py-3 px-4 text-sm font-medium whitespace-nowrap "+("quality"===y?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-white"),onClick:()=>b("quality"),children:"Code Quality"}),r.jsx("button",{className:"py-3 px-4 text-sm font-medium whitespace-nowrap "+("performance"===y?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-white"),onClick:()=>b("performance"),children:"Performance"}),r.jsx("button",{className:"py-3 px-4 text-sm font-medium whitespace-nowrap "+("parameters"===y?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-white"),onClick:()=>b("parameters"),children:"Parameters"}),r.jsxs("button",{className:"py-3 px-4 text-sm font-medium flex items-center whitespace-nowrap "+("assistant"===y?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-white"),onClick:()=>b("assistant"),children:[r.jsx(i,{className:"mr-2"}),"Psscript AI"]})]})}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[r.jsxs("div",{className:"md:col-span-2",children:["overview"===y&&r.jsxs("div",{className:"bg-gray-700 rounded-lg shadow mb-6",children:[r.jsx("div",{className:"p-4 bg-gray-800 border-b border-gray-600",children:r.jsx("h2",{className:"text-lg font-medium",children:"Analysis Summary"})}),M?r.jsxs("div",{className:"p-6",children:[r.jsx("p",{className:"text-gray-300 mb-6",children:I.purpose||"No purpose provided."}),r.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 mb-8",children:[V(I.codeQualityScore,"Quality"),V(I.securityScore,"Security"),V(I.riskScore,"Risk",!0),"number"==typeof I.reliabilityScore&&V(I.reliabilityScore,"Reliability")]}),r.jsxs("div",{className:"mt-6 space-y-6",children:[r.jsxs("div",{children:[r.jsxs("h3",{className:"text-lg font-medium mb-4 flex items-center",children:[r.jsx("svg",{className:"w-5 h-5 mr-2 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Key Findings"]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx("div",{className:"p-4 rounded-lg border "+(I.securityScore>7?"bg-green-900 bg-opacity-20 border-green-700":"bg-yellow-900 bg-opacity-20 border-yellow-700"),children:r.jsxs("div",{className:"flex items-start",children:[I.securityScore>7?r.jsx(a,{className:"text-green-400 mt-1 mr-3 flex-shrink-0 text-xl"}):r.jsx(l,{className:"text-yellow-400 mt-1 mr-3 flex-shrink-0 text-xl"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium mb-1",children:"Security Assessment"}),r.jsx("p",{className:"text-gray-300",children:I.securityScore>7?"Follows good security practices.":"Has some security concerns that should be addressed."})]})]})}),r.jsx("div",{className:"p-4 rounded-lg border "+(I.codeQualityScore>7?"bg-green-900 bg-opacity-20 border-green-700":I.codeQualityScore>5?"bg-blue-900 bg-opacity-20 border-blue-700":"bg-yellow-900 bg-opacity-20 border-yellow-700"),children:r.jsxs("div",{className:"flex items-start",children:[I.codeQualityScore>7?r.jsx(a,{className:"text-green-400 mt-1 mr-3 flex-shrink-0 text-xl"}):I.codeQualityScore>5?r.jsx(l,{className:"text-blue-400 mt-1 mr-3 flex-shrink-0 text-xl"}):r.jsx(l,{className:"text-yellow-400 mt-1 mr-3 flex-shrink-0 text-xl"}),r.jsxs("div",{children:[r.jsx("h4",{className:"font-medium mb-1",children:"Code Quality"}),r.jsxs("p",{className:"text-gray-300",children:["Code quality is ",I.codeQualityScore>7?"high":I.codeQualityScore>5?"moderate":"needs improvement"," with potential for optimization."]})]})]})}),I.securityIssues&&I.securityIssues.length>0?r.jsx("div",{className:"p-4 rounded-lg border bg-red-900 bg-opacity-20 border-red-700",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(n,{className:"text-red-500 mt-1 mr-3 flex-shrink-0"}),r.jsx("div",{children:r.jsxs("p",{className:"text-red-300",children:[I.securityIssues.length," security ",1===I.securityIssues.length?"issue":"issues"," found."]})})]})}):r.jsx("div",{className:"p-4 rounded-lg border bg-green-900 bg-opacity-20 border-green-700",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(a,{className:"text-green-500 mt-1 mr-3 flex-shrink-0"}),r.jsx("div",{children:r.jsx("p",{className:"text-green-300",children:"No significant security concerns were found in this script."})})]})}),I.performanceInsights&&I.performanceInsights.length>0?r.jsx("div",{className:"p-4 rounded-lg border bg-purple-900 bg-opacity-20 border-purple-700",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(c,{className:"text-purple-400 mt-1 mr-3 flex-shrink-0"}),r.jsx("div",{children:r.jsxs("p",{className:"text-purple-300",children:[I.performanceInsights.length," performance ",1===I.performanceInsights.length?"insight":"insights"," found."]})})]})}):r.jsx("div",{className:"p-4 rounded-lg border bg-blue-900 bg-opacity-20 border-blue-700",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(a,{className:"text-blue-400 mt-1 mr-3 flex-shrink-0"}),r.jsx("div",{children:r.jsx("p",{className:"text-blue-300",children:"No specific performance optimization suggestions were identified for this script."})})]})})]})]}),I.commandDetails&&I.commandDetails.length>0&&r.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-600",children:[r.jsxs("h3",{className:"text-lg font-medium mb-3 flex items-center",children:[r.jsx("svg",{className:"w-5 h-5 mr-2 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2z"})}),"Key PowerShell Commands Analysis"]}),r.jsx("div",{className:"space-y-6",children:I.commandDetails.map((e,s)=>r.jsxs("div",{className:"bg-gradient-to-r from-gray-800 to-gray-900 p-4 rounded-lg border border-gray-700 shadow-md",children:[r.jsx("h4",{className:"text-blue-400 font-medium mb-3",children:e.name}),r.jsxs("div",{className:"space-y-3",children:[e.description&&r.jsx("p",{className:"text-gray-300",children:e.description}),e.usage&&r.jsxs("div",{className:"bg-gray-900 bg-opacity-50 p-3 rounded-lg",children:[r.jsx("h5",{className:"text-sm text-blue-300 font-semibold mb-2",children:"Usage in Script"}),r.jsx("p",{className:"text-gray-300",children:e.usage})]}),e.documentation_url&&r.jsx("div",{className:"mt-2",children:r.jsxs("a",{href:e.documentation_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 flex items-center",children:[r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),"Microsoft Documentation"]})})]})]},s))})]}),I.msDocsReferences&&I.msDocsReferences.length>0&&r.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-600",children:[r.jsxs("h3",{className:"text-lg font-medium mb-3 flex items-center",children:[r.jsx("svg",{className:"w-5 h-5 mr-2 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Microsoft Documentation References"]}),r.jsx("div",{className:"bg-gray-800 p-4 rounded-lg border border-gray-700",children:r.jsx("ul",{className:"space-y-3",children:I.msDocsReferences.map((e,s)=>r.jsxs("li",{className:"flex items-start bg-gray-900 bg-opacity-50 p-3 rounded-lg hover:bg-opacity-70 transition-colors duration-200",children:[r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-blue-400 mr-3 mt-0.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),r.jsxs("div",{children:[r.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 font-medium",children:e.command||e.title||"Documentation"}),e.description&&r.jsx("p",{className:"text-gray-400 text-sm mt-1",children:e.description})]})]},s))})})]}),r.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-600",children:[r.jsxs("h3",{className:"text-lg font-medium mb-3 flex items-center",children:[r.jsx(i,{className:"mr-2 text-blue-400"}),"AI Command Analysis"]}),r.jsx("div",{className:"bg-gray-800 p-4 rounded-lg border border-gray-700 overflow-auto",children:r.jsx("pre",{className:"text-sm text-gray-300 whitespace-pre-wrap font-mono",children:(()=>{if(!M)return"Analysis data is not available.";const e=I.commandDetails?.map(e=>e.name).join(", ")||"N/A",s=I.parameters&&Object.keys(I.parameters).length>0,t=I.commandDetails?.some(e=>e.name.startsWith("Write-Output"))?"Returns objects suitable for pipeline.":"May not return pipeline-friendly objects (uses Write-Host?).",r=I.commandDetails?.some(e=>e.name.startsWith("Invoke-"))?"Makes network calls.":"No direct network calls identified.",i="Requires permissions for file system access "+(I.commandDetails?.some(e=>e.name.includes("Service"))?"and potentially service management.":"."),a=I.codeQualityScore>7?"Comprehensive":I.codeQualityScore>5?"Basic":"Limited",l=I.performanceInsights?.length>0?"Potential for high resource usage identified.":"Appears efficient for typical use.",n=I.performanceInsights?.some(e=>e.description.includes("memory"))?"Potential memory concerns for large inputs.":"Likely low to moderate.",c=I.commandDetails?.some(e=>e.name.startsWith("Write-Output"))?"Objects via pipeline.":I.commandDetails?.some(e=>e.name.startsWith("Out-File"))?"Output written to file.":"Output likely via Write-Host.",d=I.commandDetails?.some(e=>e.name.startsWith("Write-Output"))?"Raw objects.":"Text output.",o=I.optimizationSuggestions&&I.optimizationSuggestions.length>0?I.optimizationSuggestions.map(e=>`* ${e}`).join("\n"):"* No specific optimization suggestions identified by AI.",m=I.securityIssues&&I.securityIssues.length>0?I.securityIssues.map(e=>`* [Security/${e.severity}] ${e.description} (Line ${e.line_number||"N/A"})`).join("\n"):"",x=I.bestPracticeViolations&&I.bestPracticeViolations.length>0?I.bestPracticeViolations.map(e=>`* [Best Practice/${e.severity}] ${e.description} (Line ${e.line_number||"N/A"})`).join("\n"):"";return`# AI Command Analysis for ${A.title}\n\n## Script Purpose\n${I.purpose||"Purpose not clearly identified."}\n\n## Command Structure\n* Primary Commands: ${e}\n* Parameter Binding: ${s?"Uses standard PowerShell parameter binding.":"No parameters identified."}\n* Pipeline Support: ${t}\n\n## Command Safety\n* Execution Scope: Runs in the user's security context.\n* Network Activity: ${r}\n* Permissions: ${i}\n* Error Handling: ${a} error handling implemented (Score: ${I.codeQualityScore??"N/A"}/10).\n\n## Command Performance\n* Resource Usage: ${l}\n* Execution Time: Varies depending on input size and system performance.\n* Memory Impact: ${n}\n\n## Command Output\n* Output Type: ${c}\n* Formatting: ${d}\n\n## Improvement Opportunities\n${o}\n${m}\n${x||"* No specific improvement suggestions identified by AI."===o&&!m?"* No specific best practice violations identified.":""}\n`})()})})]})]})]}):r.jsx("div",{className:"p-6 text-center text-gray-400",children:"Analysis data is not available for this script. You might need to trigger the analysis."})]}),"security"===y&&r.jsxs("div",{className:"bg-gray-700 rounded-lg shadow mb-6",children:[r.jsx("div",{className:"p-4 bg-gray-800 border-b border-gray-600",children:r.jsx("h2",{className:"text-lg font-medium",children:"Security Analysis"})}),M?r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"mb-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h3",{className:"text-md font-medium",children:"Security Score"}),r.jsxs("span",{className:"px-2 py-1 rounded text-sm "+(I.securityScore>7?"bg-green-900 text-green-300":I.securityScore>4?"bg-yellow-900 text-yellow-300":"bg-red-900 text-red-300"),children:[I.securityScore??"N/A","/10"]})]}),r.jsx("div",{className:"w-full bg-gray-800 rounded-full h-2.5",children:r.jsx("div",{className:"h-2.5 rounded-full "+(I.securityScore>7?"bg-green-500":I.securityScore>4?"bg-yellow-500":"bg-red-500"),style:{width:10*(I.securityScore??0)+"%"}})})]}),I.securityIssues&&I.securityIssues.length>0?r.jsxs("div",{className:"mb-6",children:[r.jsx("h3",{className:"text-md font-medium mb-3",children:"Security Issues Found"}),r.jsx("ul",{className:"space-y-3",children:I.securityIssues.map((e,s)=>r.jsx("li",{className:`bg-${"high"===e.severity?"red":"medium"===e.severity?"yellow":"blue"}-900 bg-opacity-20 p-3 rounded-lg border border-${"high"===e.severity?"red":"medium"===e.severity?"yellow":"blue"}-700`,children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(n,{className:`text-${"high"===e.severity?"red":"medium"===e.severity?"yellow":"blue"}-500 mt-1 mr-3 flex-shrink-0`}),r.jsxs("div",{children:[r.jsxs("p",{className:`text-${"high"===e.severity?"red":"medium"===e.severity?"yellow":"blue"}-300 font-medium`,children:[e.description," (Severity: ",e.severity,")"]}),e.line_number&&r.jsxs("p",{className:"text-xs text-gray-400",children:["Line: ",e.line_number]}),e.remediation&&r.jsxs("p",{className:"text-sm text-gray-300 mt-1",children:["Suggestion: ",e.remediation]})]})]})},s))})]}):r.jsx("div",{className:"mb-6 bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-700",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(a,{className:"text-green-500 mt-1 mr-3 flex-shrink-0"}),r.jsx("div",{children:r.jsx("p",{className:"text-green-300",children:"No significant security concerns were found in this script."})})]})}),r.jsxs("div",{className:"mt-6",children:[r.jsx("h3",{className:"text-md font-medium mb-3",children:"Best Practice Violations"}),I.bestPracticeViolations&&I.bestPracticeViolations.length>0?r.jsx("ul",{className:"space-y-3",children:I.bestPracticeViolations.map((e,s)=>r.jsxs("li",{className:"flex items-start bg-yellow-900 bg-opacity-20 p-3 rounded-lg border border-yellow-700",children:[r.jsx(l,{className:"text-yellow-400 mt-1 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsxs("p",{className:"text-yellow-300",children:[e.description," (Severity: ",e.severity,")"]}),e.line_number&&r.jsxs("p",{className:"text-xs text-gray-400",children:["Line: ",e.line_number]}),e.remediation&&r.jsxs("p",{className:"text-sm text-gray-300 mt-1",children:["Suggestion: ",e.remediation]})]})]},s))}):r.jsx("p",{className:"text-gray-400",children:"No specific best practices were identified for this script."})]})]}):r.jsx("div",{className:"p-6 text-center text-gray-400",children:"Analysis data is not available for this script."})]}),"quality"===y&&r.jsxs("div",{className:"bg-gray-700 rounded-lg shadow mb-6",children:[r.jsx("div",{className:"p-4 bg-gray-800 border-b border-gray-600",children:r.jsx("h2",{className:"text-lg font-medium",children:"Code Quality Analysis"})}),M?r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"mb-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h3",{className:"text-md font-medium",children:"Quality Score"}),r.jsxs("span",{className:"px-2 py-1 rounded text-sm "+(I.codeQualityScore>7?"bg-green-900 text-green-300":I.codeQualityScore>4?"bg-yellow-900 text-yellow-300":"bg-red-900 text-red-300"),children:[I.codeQualityScore??"N/A","/10"]})]}),r.jsx("div",{className:"w-full bg-gray-800 rounded-full h-2.5",children:r.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:10*(I.codeQualityScore??0)+"%"}})})]}),I.optimizationSuggestions&&I.optimizationSuggestions.length>0?r.jsxs("div",{className:"mb-6",children:[r.jsx("h3",{className:"text-md font-medium mb-3",children:"Suggested Improvements"}),r.jsx("div",{className:"space-y-3",children:I.optimizationSuggestions.map((e,s)=>r.jsx("div",{className:"bg-blue-900 bg-opacity-20 p-3 rounded-lg border border-blue-800",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(c,{className:"text-yellow-400 mt-1 mr-3 flex-shrink-0"}),r.jsx("div",{children:r.jsx("p",{className:"text-gray-300",children:e})})]})},s))})]}):r.jsx("p",{className:"text-gray-400 mb-6",children:"No specific optimization suggestions available."}),I.codeComplexityMetrics&&Object.keys(I.codeComplexityMetrics).length>0?r.jsxs("div",{className:"mb-6",children:[r.jsx("h3",{className:"text-md font-medium mb-3",children:"Code Complexity"}),I.codeComplexityMetrics.cyclomaticComplexity?r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{children:"Cyclomatic Complexity:"}),r.jsx("span",{className:"px-2 py-1 rounded text-sm "+(I.codeComplexityMetrics.cyclomaticComplexity<10?"bg-green-900 text-green-300":I.codeComplexityMetrics.cyclomaticComplexity<20?"bg-yellow-900 text-yellow-300":"bg-red-900 text-red-300"),children:I.codeComplexityMetrics.cyclomaticComplexity})]}):null,r.jsx("p",{className:"text-sm text-gray-400 mt-2",children:I.codeQualityScore>7?"Low complexity.":"Moderate to high complexity."})]}):r.jsx("p",{className:"text-gray-400",children:"Code complexity metrics not available."})]}):r.jsx("div",{className:"p-6 text-center text-gray-400",children:"Analysis data is not available for this script."})]}),"performance"===y&&r.jsxs("div",{className:"bg-gray-700 rounded-lg shadow mb-6",children:[r.jsx("div",{className:"p-4 bg-gray-800 border-b border-gray-600",children:r.jsx("h2",{className:"text-lg font-medium",children:"Performance Analysis"})}),M?r.jsxs("div",{className:"p-6",children:[I.performanceInsights&&I.performanceInsights.length>0?r.jsxs("div",{className:"mb-6",children:[r.jsx("h3",{className:"text-md font-medium mb-3",children:"Performance Insights"}),r.jsx("div",{className:"space-y-4",children:I.performanceInsights.map((e,s)=>r.jsx("div",{className:"bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-800",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(d,{className:"text-green-400 mt-1 mr-3 flex-shrink-0"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-gray-300",children:e.description}),e.line_number&&r.jsxs("p",{className:"text-xs text-gray-400",children:["Line: ",e.line_number]}),e.suggestion&&r.jsxs("p",{className:"text-sm text-green-300 mt-1",children:["Suggestion: ",e.suggestion]})]})]})},s))})]}):r.jsx("div",{className:"mb-6 bg-blue-900 bg-opacity-20 p-4 rounded-lg",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(l,{className:"text-blue-400 mt-1 mr-3 flex-shrink-0"}),r.jsx("div",{children:r.jsx("p",{className:"text-gray-300",children:"No specific performance optimization suggestions were identified for this script."})})]})}),I.reliabilityScore&&r.jsxs("div",{className:"mb-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h3",{className:"text-md font-medium",children:"Reliability Score"}),r.jsxs("span",{className:"px-2 py-1 rounded text-sm "+(I.reliabilityScore>7?"bg-green-900 text-green-300":I.reliabilityScore>4?"bg-yellow-900 text-yellow-300":"bg-red-900 text-red-300"),children:[I.reliabilityScore,"/10"]})]}),r.jsx("div",{className:"w-full bg-gray-800 rounded-full h-2.5",children:r.jsx("div",{className:"h-2.5 rounded-full "+(I.reliabilityScore>7?"bg-green-500":I.reliabilityScore>4?"bg-yellow-500":"bg-red-500"),style:{width:10*I.reliabilityScore+"%"}})}),r.jsx("p",{className:"text-sm text-gray-400 mt-2",children:I.reliabilityScore>7?"High reliability - script handles errors well and should operate consistently.":I.reliabilityScore>4?"Moderate reliability - additional error handling would improve robustness.":"Low reliability - significant improvements to error handling recommended."})]})]}):r.jsx("div",{className:"p-6 text-center text-gray-400",children:"Analysis data is not available for this script."})]}),"parameters"===y&&r.jsxs("div",{className:"bg-gray-700 rounded-lg shadow mb-6",children:[r.jsx("div",{className:"p-4 bg-gray-800 border-b border-gray-600",children:r.jsx("h2",{className:"text-lg font-medium",children:"Script Parameters"})}),M?r.jsx("div",{className:"p-6",children:I?.parameters&&Object.keys(I.parameters).length>0?r.jsx("div",{className:"space-y-6",children:Object.entries(I.parameters||{}).map(([e,s])=>r.jsxs("div",{className:"border border-gray-600 rounded-lg overflow-hidden",children:[r.jsxs("div",{className:"bg-gray-800 p-3 flex justify-between items-center",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"text-white font-mono",children:e}),s.mandatory&&r.jsx("span",{className:"ml-2 px-2 py-0.5 bg-red-900 text-red-300 rounded text-xs",children:"Required"})]}),r.jsx("span",{className:"text-gray-400 text-sm",children:s.type||"String"})]}),r.jsxs("div",{className:"p-3",children:[s.description&&r.jsx("p",{className:"text-gray-300",children:s.description}),s.defaultValue&&r.jsxs("div",{className:"mt-2",children:[r.jsx("span",{className:"text-gray-400 text-sm",children:"Default: "}),r.jsx("code",{className:"bg-gray-800 px-2 py-0.5 rounded text-yellow-300",children:s.defaultValue})]}),s.validValues&&s.validValues.length>0&&r.jsxs("div",{className:"mt-2",children:[r.jsx("span",{className:"text-gray-400 text-sm",children:"Valid values: "}),r.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.validValues.map((e,s)=>r.jsx("code",{className:"bg-gray-800 px-2 py-0.5 rounded text-blue-300",children:e},s))})]})]})]},e))}):r.jsx("div",{className:"bg-blue-900 bg-opacity-20 p-4 rounded-lg",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(l,{className:"text-blue-400 mt-1 mr-3 flex-shrink-0"}),r.jsx("div",{children:r.jsx("p",{className:"text-gray-300",children:"This script does not have any identified parameters."})})]})})}):r.jsx("div",{className:"p-6 text-center text-gray-400",children:"Analysis data is not available for this script."})]}),"assistant"===y&&r.jsxs("div",{className:"bg-gray-700 rounded-lg shadow mb-6 flex flex-col h-[600px]",children:[r.jsx("div",{className:"p-4 bg-gray-800 border-b border-gray-600",children:r.jsxs("h2",{className:"text-lg font-medium flex items-center",children:[r.jsx(i,{className:"mr-2 text-blue-400"}),"Psscript AI Assistant"]})}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:r.jsxs("div",{className:"space-y-4",children:[j.map((e,s)=>r.jsx("div",{className:"flex "+("user"===e.role?"justify-end":"justify-start"),children:r.jsx("div",{className:"max-w-3/4 rounded-lg p-3 "+("user"===e.role?"bg-blue-600 text-white":"bg-gray-800 text-gray-200"),children:r.jsx(o,{components:{code:({node:e,inline:s,className:t,children:i,...a})=>s?r.jsx("code",{className:"bg-gray-900 px-1 rounded font-mono text-yellow-300",...a,children:i}):r.jsx(L,{className:t,children:i}),h1:({children:e})=>r.jsx("h1",{className:"text-xl font-bold mb-2",children:e}),h2:({children:e})=>r.jsx("h2",{className:"text-lg font-bold mb-2",children:e}),h3:({children:e})=>r.jsx("h3",{className:"text-md font-bold mb-2",children:e}),p:({children:e})=>r.jsx("p",{className:"mb-2",children:e}),ul:({children:e})=>r.jsx("ul",{className:"list-disc pl-5 mb-2",children:e}),ol:({children:e})=>r.jsx("ol",{className:"list-decimal pl-5 mb-2",children:e}),li:({children:e,...s})=>r.jsx("li",{className:"mb-1",...s,children:e}),text:({children:e})=>{const s=String(e);return s.trim().match(/^[-*]\s/)||s.trim().match(/^\d+\.\s/)?r.jsx("div",{className:"mb-1 pl-2 border-l-2 border-gray-600",children:e}):r.jsx(r.Fragment,{children:e})}},children:e.content})})},s)),w&&r.jsx("div",{className:"flex justify-start",children:r.jsx("div",{className:"bg-gray-800 text-white rounded-lg p-3",children:r.jsxs("div",{className:"flex space-x-2",children:[r.jsx("div",{className:"w-2 h-2 rounded-full bg-gray-500 animate-pulse"}),r.jsx("div",{className:"w-2 h-2 rounded-full bg-gray-500 animate-pulse delay-75"}),r.jsx("div",{className:"w-2 h-2 rounded-full bg-gray-500 animate-pulse delay-150"})]})})}),r.jsx("div",{ref:k})]})}),r.jsxs("div",{className:"p-4 border-t border-gray-600",children:[r.jsxs("form",{onSubmit:e=>{e.preventDefault(),(async()=>{if(!f.trim())return;const e={role:"user",content:f};v(""),S(!0),N(s=>[...s,e]);try{const s=`You are Psscript AI, a PowerShell scripting assistant analyzing the following script:\n\nTitle: ${A?.title||"N/A"}\nPurpose: ${I?.purpose||"N/A"}\nSecurity Score: ${I?.securityScore??"N/A"}/10\nCode Quality Score: ${I?.codeQualityScore??"N/A"}/10\n\nYou should help the user understand this script, address any concerns, and suggest improvements.\nBe specific and reference details from the script analysis when possible.\nIf you don't know something specific about the script, be honest about it.\n`,t="http://localhost:4005/api",r=await h.post(`${t}/chat`,{messages:[...j,e],system_prompt:s},{headers:{"Content-Type":"application/json"},timeout:3e4});if(!r.data||!r.data.response)throw new Error("Invalid response format from AI service");N(e=>[...e,{role:"assistant",content:r.data.response}])}catch(s){console.error("Error sending message to AI:",s),N(e=>[...e,{role:"assistant",content:"I'm sorry, I encountered an error processing your request. Please try again later."}])}finally{S(!1)}})()},className:"flex space-x-2",children:[r.jsx("input",{type:"text",value:f,onChange:e=>v(e.target.value),placeholder:"Ask about your PowerShell script...",className:"flex-1 bg-gray-800 text-white border border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:w}),r.jsxs("button",{type:"submit",disabled:w||!f.trim(),className:"bg-blue-600 text-white rounded-lg px-4 py-2 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:[r.jsx(m,{className:"mr-2"}),"Send"]})]}),r.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Ask questions about your script to get AI-powered insights and recommendations."})]})]})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"bg-gray-700 rounded-lg shadow",children:[r.jsx("div",{className:"p-4 bg-gray-800 border-b border-gray-600",children:r.jsx("h2",{className:"text-lg font-medium",children:"Script Information"})}),r.jsx("div",{className:"p-4",children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm text-gray-400",children:"Title"}),r.jsx("p",{className:"text-white font-medium",children:A.title})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm text-gray-400",children:"Category"}),r.jsx("p",{className:"text-white",children:A.category?.name||"Uncategorized"})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm text-gray-400",children:"Author"}),r.jsx("p",{className:"text-white",children:A.user?.username||"Unknown"})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm text-gray-400",children:"Version"}),r.jsx("p",{className:"text-white",children:A.version||"1.0"})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm text-gray-400",children:"Last Updated"}),r.jsx("p",{className:"text-white",children:new Date(A.updatedAt).toLocaleDateString()})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm text-gray-400",children:"Execution Count"}),r.jsx("p",{className:"text-white",children:A.executionCount||0})]})]})})]}),r.jsxs("div",{className:"bg-gray-700 rounded-lg shadow",children:[r.jsx("div",{className:"p-4 bg-gray-800 border-b border-gray-600",children:r.jsx("h2",{className:"text-lg font-medium",children:"Actions"})}),r.jsx("div",{className:"p-4",children:r.jsxs("div",{className:"space-y-3",children:[r.jsx("button",{onClick:()=>g(`/scripts/${p}`),className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center justify-center",children:"View Script"}),r.jsx("button",{onClick:()=>g(`/scripts/${p}/edit`),className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 flex items-center justify-center",children:"Edit Script"}),r.jsx("button",{onClick:()=>window.open(`/api/scripts/${p}/export-analysis`,"_blank"),className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 flex items-center justify-center",children:"Export Analysis"})]})})]}),r.jsxs("div",{className:"bg-gray-700 rounded-lg shadow overflow-hidden",children:[r.jsx("div",{className:"p-4 bg-gradient-to-r from-indigo-800 to-blue-700 border-b border-gray-600",children:r.jsxs("h2",{className:"text-lg font-medium flex items-center",children:[r.jsx(i,{className:"mr-2"}),"Analysis Information"]})}),r.jsx("div",{className:"p-4",children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-900 flex items-center justify-center mr-3",children:r.jsx("svg",{className:"w-6 h-6 text-blue-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm text-gray-400",children:"Analysis Date"}),r.jsx("p",{className:"text-white font-medium",children:new Date(I?.updatedAt||I?.createdAt||Date.now()).toLocaleDateString()})," "]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-900 flex items-center justify-center mr-3",children:r.jsx("svg",{className:"w-6 h-6 text-purple-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm text-gray-400",children:"Analysis Model"}),r.jsx("p",{className:"text-white font-medium",children:I?.analysisModel||"Mock AI"})," "]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"w-10 h-10 rounded-full bg-green-900 flex items-center justify-center mr-3",children:r.jsx("svg",{className:"w-6 h-6 text-green-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm text-gray-400",children:"Analysis Version"}),r.jsx("p",{className:"text-white font-medium",children:I?.analysisVersion||"1.0"})," "]})]}),r.jsx("div",{className:"mt-4 pt-4 border-t border-gray-600 bg-gray-800 rounded-lg p-3",children:r.jsxs("div",{className:"flex items-start",children:[r.jsx(l,{className:"text-blue-400 mt-1 mr-2 flex-shrink-0"}),r.jsx("p",{className:"text-xs text-gray-300",children:"AI analysis is provided as guidance and may not catch all issues. Always review scripts manually before use in production environments."})]})})]})})]})]})]})]})};export{p as default};
