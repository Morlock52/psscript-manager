import{r as e,j as t,O as a,u as s,M as r}from"./react-vendor-chunk-814f15fe.js";import{S as o,N as l,u as i,e as n}from"../assets/index-c161c383.js";import"./editor-chunk-85777d73.js";import"./data-fetching-chunk-acdfbf86.js";const c=({children:s,hideSidebar:r=!1})=>{const[i,n]=e.useState("false"!==localStorage.getItem("sidebar-open"));e.useEffect(()=>{console.log("DEBUG: Layout - Sidebar state:",i?"open":"closed")},[i]);const[c,d]=e.useState(localStorage.getItem("color-theme")||"dark");e.useEffect(()=>{console.log("DEBUG: Layout - Saving sidebar state to localStorage:",i),localStorage.setItem("sidebar-open",String(i))},[i]),e.useEffect(()=>{console.log("DEBUG: Layout - Theme initialized:",c),"dark"===c?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[c]);const h=()=>{console.log("DEBUG: Layout - Toggling sidebar from",i,"to",!i),n(!i)};return t.jsxs("div",{className:"flex h-screen overflow-hidden transition-colors duration-300\n      "+("dark"===c?"bg-gray-900 text-white":"bg-gray-50 text-gray-900"),children:[!r&&t.jsx("div",{className:`transition-all duration-300 ease-in-out\n            ${i?"w-64":"w-0 md:w-16"} \n            ${i?"opacity-100":"opacity-0 md:opacity-100"}`,children:t.jsx(o,{isOpen:i,onClose:h})}),t.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden",children:[t.jsx(l,{onMenuClick:h}),t.jsx("main",{className:"flex-1 overflow-y-auto p-4 transition-colors duration-300\n          "+("dark"===c?"bg-gray-800":"bg-white"),children:s||t.jsx(a,{})})]})]})},d=()=>{const{theme:a}=i(),o=s(),[l,d]=e.useState([]),[h,g]=e.useState([]),[u,m]=e.useState(!0),[x,b]=e.useState("all"),[y,p]=e.useState(""),[f,v]=e.useState(null);e.useEffect(()=>{(async()=>{m(!0);try{const e=(await n.getChatHistory()).history.map(e=>({...e,timestamp:new Date(e.timestamp||Date.now()).toLocaleString()}));d(e);const t=await n.getChatCategories();g(["all","uncategorized",...t])}catch(e){console.error("Error loading chat history data:",e)}finally{m(!1)}})()},[o]);const j=l.filter(e=>{if("all"!==x){if("uncategorized"===x&&e.category)return!1;if("uncategorized"!==x&&e.category!==x)return!1}if(y.trim()){const t=y.toLowerCase();return e.messages.some(e=>e.content.toLowerCase().includes(t))}return!0});return t.jsx(c,{children:t.jsx("div",{className:"min-h-screen "+("dark"===a?"bg-gray-900 text-gray-100":"bg-gray-50 text-gray-900"),children:t.jsxs("div",{className:"container mx-auto py-6 px-4",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsx("h1",{className:"text-2xl font-bold",children:"Chat History"}),t.jsx("button",{onClick:()=>o("/chat"),className:"px-4 py-2 rounded font-medium "+("dark"===a?"bg-blue-600 hover:bg-blue-500":"bg-blue-600 text-white hover:bg-blue-500"),children:"New Chat"})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:`lg:col-span-1 ${"dark"===a?"bg-gray-800":"bg-white"} rounded-lg shadow p-4`,children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("input",{type:"text",value:y,onChange:e=>p(e.target.value),placeholder:"Search chat history...",className:`w-full p-2 rounded ${"dark"===a?"bg-gray-700 border-gray-600":"bg-gray-100 border-gray-300"} border focus:ring-2 focus:ring-blue-500 focus:outline-none mb-3`}),t.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:h.map(e=>t.jsx("button",{onClick:()=>b(e),className:"px-3 py-1 text-sm rounded-full "+(x===e?"dark"===a?"bg-blue-600 text-white":"bg-blue-500 text-white":"dark"===a?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),t.jsx("div",{className:"max-h-[calc(100vh-300px)] overflow-y-auto",children:u?t.jsx("div",{className:"py-10 text-center",children:t.jsx("div",{className:"inline-block",children:t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce"}),t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce delay-150"}),t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce delay-300"})]})})}):j.length>0?j.map(e=>t.jsxs("div",{onClick:()=>v(e),className:`p-3 mb-2 rounded cursor-pointer ${f?.id===e.id?"dark"===a?"bg-blue-800 border-blue-700":"bg-blue-100 border-blue-200":"dark"===a?"bg-gray-700 hover:bg-gray-600 border-gray-600":"bg-white hover:bg-gray-100 border-gray-200"} border`,children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-xs opacity-70",children:e.timestamp}),e.category&&t.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full "+("dark"===a?"bg-blue-900 text-blue-200":"bg-blue-100 text-blue-800"),children:e.category})]}),t.jsxs("div",{className:"mt-1 text-sm truncate",children:[e.messages[0]?.content.substring(0,100)||"No content","..."]})]},e.id)):t.jsx("div",{className:"py-10 text-center text-gray-500",children:"No chat sessions found"})})]}),t.jsx("div",{className:`lg:col-span-2 ${"dark"===a?"bg-gray-800":"bg-white"} rounded-lg shadow`,children:f?t.jsxs("div",{className:"h-full flex flex-col",children:[t.jsxs("div",{className:"p-4 flex justify-between items-center border-b "+("dark"===a?"border-gray-700":"border-gray-200"),children:[t.jsxs("div",{children:[t.jsxs("span",{className:"text-sm opacity-70",children:["Session: ",f.timestamp]}),t.jsx("div",{className:"flex gap-2 mt-2",children:t.jsxs("select",{value:f.category||"",onChange:e=>(async(e,t)=>{try{await n.setChatCategory(e,t),d(a=>a.map(a=>a.id===e?{...a,category:t}:a))}catch(a){console.error("Error setting chat category:",a)}})(f.id,e.target.value),className:`text-xs px-2 py-1 rounded ${"dark"===a?"bg-gray-700 border-gray-600":"bg-gray-100 border-gray-300"} border focus:ring-2 focus:ring-blue-500 focus:outline-none`,children:[t.jsx("option",{value:"",children:"Uncategorized"}),h.filter(e=>"all"!==e&&"uncategorized"!==e).map(e=>t.jsx("option",{value:e,children:e},e))]})})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>(e=>{try{if(!e||!Array.isArray(e.messages))throw new Error("Invalid session data");localStorage.setItem("psscript_chat_history",JSON.stringify(e.messages));try{o("/chat")}catch(t){console.error("Navigation error:",t),window.location.href="/chat"}}catch(a){console.error("Error continuing chat:",a),alert("Could not continue this chat. Starting a new chat...");try{localStorage.removeItem("psscript_chat_history"),o("/chat")}catch(s){window.location.href="/chat"}}})(f),className:"px-3 py-1 text-sm rounded "+("dark"===a?"bg-green-700 hover:bg-green-600 text-white":"bg-green-600 hover:bg-green-500 text-white"),children:"Continue Chat"}),t.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this chat session?"))try{if("function"!=typeof n.deleteChatSession)throw console.error("deleteChatSession method not available"),new Error("Delete method not available");await n.deleteChatSession(e),d(t=>t.filter(t=>t.id!==e)),f?.id===e&&v(null)}catch(t){console.error("Error deleting chat session:",t),alert("Failed to delete chat session. It will be removed from the view but may still exist on the server."),d(t=>t.filter(t=>t.id!==e)),f?.id===e&&v(null)}})(f.id),className:"px-3 py-1 text-sm rounded "+("dark"===a?"bg-red-700 hover:bg-red-600 text-white":"bg-red-600 hover:bg-red-500 text-white"),children:"Delete"})]})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:f.messages.map((e,s)=>t.jsx("div",{className:`mb-4 ${"user"===e.role?"ml-auto":"mr-auto"} max-w-[80%]`,children:t.jsx("div",{className:"p-3 rounded-lg "+("user"===e.role?"bg-blue-600 text-white":"dark"===a?"bg-gray-700 border border-gray-600":"bg-gray-100 shadow"),children:t.jsx(r,{className:"prose prose-sm max-w-none",children:e.content})})},s))})]}):t.jsx("div",{className:"h-full flex items-center justify-center p-10 text-center text-gray-500",children:t.jsxs("div",{children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mx-auto mb-4 opacity-20",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),t.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Chat Session Selected"}),t.jsx("p",{children:"Select a chat session from the list to view its contents"})]})})})]})]})})})};export{d as default};
